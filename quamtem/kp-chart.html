<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>KP Chart Generator – Neon All-in-One</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    :root {
      --main-bg: #070c16;
      --panel-bg: #101823;
      --panel-glow: #1d2537;
      --neon: #60a5fa;
      --neon2: #2df3c2;
      --neon3: #e6b2ff;
      --serenity: #e2f0ffvar(--main-bg); color:var(--serenity); font-family:var(--font-main); margin:0; min-height:100vh; }
    a { color:var(--neon); text-decoration:underline; }
    .wrap {
      max-width:480px; margin:36px auto; padding:0 0 32px 0 #12223a;
      position:relative;
      animation: neonBox 1.2s cubic-bezier(.9,.2,.5,1.7);
    }
    @keyframes neonBox {
      0% { box-shadow:0 0 0 0 #1d2537,0 0 0 0 #2df3c2,0 0 0 0 #e6b2ff;}
      100%{ box-shadow:0 0 32px 0 #12223a;}
    }
    h2 { font-weight:700; margin:13px 0 4px; font-size:0.98rem; }
    input, select, textarea {
      width:100%; padding:8px 11px; border-radius:7px;
      border:1.5px solid #222d3f; background:#0d1321; color:var(--serenity);
      font-size:1rem; margin-bottom:9px; outline:none;
      box-shadow:0 0 0 0 #2df3c2;
      transition: box-shadow .28s;
    }
    input:focus, select:focus, textarea:focus {
      border:1.5px solid var(--neon2);
      box-shadow:0 0 10px 1px var(--neon2);
    }
    button {
      background: linear-gradient(90deg,var(--neon),var(--neon3),var(--neon2));
      color:#070c16; border:0; border-radius:10px;
      padding:10px 22px; margin:10px 0; cursor:pointer;
      font-weight:700; letter-spacing:0.04em; font-size:1.06rem;
      box-shadow:0 0 12px 1px var(--neon2),0 2px 8px #050910;
      text-shadow:0 0 2px #fff8;
      transition:filter .18s;
    }
    button:hover { filter:brightness(1.18) drop-shadow(0 0 4px var(--neon3)); }
    #map {
      height: 160px; width:98%; border-radius:9px; margin:13px auto 14px auto;
      box-shadow:0 0 14px 2px #0d2237;
      min-width:180px;
      max-width:400px;
      background:#101d2e;
      display:block;
    }
    .row { display:flex; gap:10px; }
    .row > div { flex:1; }
    .status { font-size:14px; color:var(--neon2); margin-top:7px; min-height:20px;}
    table { width:100%; border-collapse:collapse; margin-top:15px; background:rgba(12,18,34,0.96); border-radius:10px; box-shadow:0 0 8px #232283951; padding:7px 2px; font-size:0.97rem; }
    th { color:var(--neon3); font-weight:600; background:rgba(17,25,40,0.98); }
    td { color:var(--serenity); }
    .chart-section { margin: 23px 0 0 0; }
    textarea { width:100%; background:#151f33; color:#bfe1ff; border-radius:8px; border:1.5px solid #1b2b4a; padding:7px; margin-top:13px; font-size:0.98rem;}
    .rasi-ico { filter:drop-shadow(0 0 5px var(--neon)); }
    .rasi-label { font-weight:600; letter-spacing:.04em; font-size:1rem; fill:var(--white); text-shadow:0 0 5px var(--neon2);}
    .plan-dot { stroke-width:2.1; }
    .form-glow { 
      background:rgba(9,16,32,0.97); 
      box-shadow:0 0 15px 3px var(--neon3),0 0 6px 1px #262b34; 
      border-radius:13px; padding:16px 10px 7px 10px; margin-bottom:18px;
      transition:box-shadow .28s;
    }
    .form-glow:focus-within { box-shadow:0 0 25px 5px var(--neon2); }
    @media (max-width:600px) {
      .wrap {padding:2px;}
      .row { flex-direction:column; gap:4px;}
      #wheel svg { width:99vw !important; height:auto !important;}
      #map {height:110px;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>KP Chart Generator <span style="font-size:0.98rem;color:var(--neon2);text-shadow:0 0 2px #fff;" >– Neon Edition</span></h2>
    <div class="form-glow">
      <form id="kpForm" autocomplete="off">
        <label>Name</label>
        <input type="text" id="name" required>
        <div class="row">
          <div>
            <label>Date of Birth</label>
            <input type="date" id="dob" required>
          </div>
          <div>
            <label>Time of Birth</label>
            <input type="time" id="tob" required>
          </div>
        </div>
        <label>Place of Birth</label>
        <input type="text" id="pob" placeholder="e.g. Colombo">
        <div class="row">
          <div>
            <label>Latitude</label>
            <input type="number" id="lat" step="0.0001" required placeholder="Click on map or enter">
          </div>
          <div>
            <label>Longitude</label>
            <input type="number" id="lon" step="0.0001" required placeholder="Click on map or enter">
          </div>
        </div>
        <label>Time Zone 
          <button type="button" id="detectTzBtn" style="float:right;margin-top:-2px;">Auto Detect</button>
        </label>
        <input type="text" id="timezone" required placeholder="+05:30">
        <button type="submit">Generate Chart</button>
        <div class="status" id="status"></div>
      </form>
    </div>
    <div id="map"></div>
    <div class="chart-section">
      <div id="wheel"></div>
      <table>
        <thead>
          <tr>
            <th>Planet</th><th>Degree</th><th>Sign</th><th>Nakshatra</th><th>Pada</th><th>Star Lord</th><th>Sub-Lord</th>
          </tr>
        </thead>
        <tbody id="tbl"></tbody>
      </table>
      <textarea id="jsonPreview" rows="6" readonly placeholder="Preview will appear here"></textarea>
    </div>
  </div>
  <!-- Street map logic in external JS file -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="street {
      try {
        let offset = -new Date().getTimezoneOffset();
        let sign = offset >= 0 ? '+' : '-';
        let absOffset = Math.abs(offset);
        let hr = Math.floor(absOffset / 60);
        let min = absOffset % 60;
        let tz = `${sign}${String(hr).padStart(2,'0')}:${String(min).padStart(2,'0')}`;
        document.getElementById('timezone').value = tz;
      } catch {
        document.getElementById('timezone').value = '+05:30';
      }
    };

    // 3 with API call or JS library for real positions)
    const SIGNS = ['Aries','Taurus','Gemini','Cancer','Leo','Virgo','Libra','Scorpio','Sagittarius','Capricorn','Aquarius','Pisces'];
    const NAKS = ['Ashwini','Bharani','Krittika','Rohini','Mrigashira','Ardra','Punarvasu','Pushya','Ashlesha','Magha','Purva Phalguni','Uttara Phalguni','Hasta','Chitra','Swati','Vishakha','Anuradha','Jyeshtha','','Uttara Ashadha','Shravana','Dhanishta','Shatabhisha','Purva Bhadrapada','Uttara Bhadrapada','Revati'];
    const DASHAS = [
      {lord:'Ketu', years:7}, {lord:'Venus', years:20}, {lord:'Sun', years:6}, {lord:'Moon', years:10},
      {lord:'Mars', years:7}, {lord:'Rahu', years:18}, {lord:'Jupiter', years:16}, {lord:'Saturn', years:19}, {lord:'Mercury', yearslet idx=0;for(let i=0;i<27;i++){list.push(DASHAS[idx%9].lord);idx++;}return list;})();
    const mod = (a,b)=>((a%b)+b)%b;
    const DEG_PER_NAK = 360/27, DEG_PER_PADA = DEG_PER_NAK/4;
    function dms(deg){
      deg=mod(deg,360);
      const d=Math.floor(deg);
      const mFloat=(deg-d)*60;
      const m=Math.floor(mFloat);
      const s=Math.round((mFloat-m)*60);
      return `${Of(deg){return SIGNS[Math.floor(mod(deg,360)/30)]}
    function nakIndex(deg){return Math.floor(mod(deg,360)/DEG_PER_NAK)}
    function padaOf(deg){const within=mod(deg,DEG_PER_NAK);return Math.floor(within/DEG_PER_PADA)+1;}
    function starLordOf(deg){return NAK_LORD[nakIndex(deg)]}
    function subLordOf(deg){
      const nIdx=nakIndex(deg);const startLord=NAK_LORD[nIdx];
      const startIdx=DASHAS      const arc=DEG_PER_NAK;const subArcs=rotated.map(d=>arc*(d.years/120));
      const within=mod(deg,DEG_PER_NAK);let acc=0;
      for(let i=0;i<subArcs.length;i++){acc+=subArcs="M18 14 C 14 2, 6 2, 2 14" stroke="#60a5fa" stroke-width="2" fill="none"/><circle cx="2" cy="14" r="1.5" fill="#60a5fa"/><circle cx="18" cy="14" r="1.5" fill="#60a5fa"/>`,
      `<circle cx="10" cy="13" r="5.5" stroke="#2df3c2" stroke-width="2" fill="none"/><path d="M4 6 Q10 0,16 6" stroke="#2df3c2" stroke-width="2" fill="none"/>`,
      `<rect x="6.5" y="6" width="7" height="8" rx="2" stroke="#e6b2ff" stroke-width="2" fill="none"/><line x1="6.5" y1="6" x2="13.5" y2="6" stroke="#e6b2ff" stroke-width="2"/><line x1="6.5" y1="14" x2="13.5" y2="14" stroke="#e6b2ff" stroke-width="2"/>`,
      `<circle cx="7" cy="13" r="2.5" stroke="#60a5fa" stroke-width="2" fill="none"/><circle cx="13" cy="7"5fa" stroke-width="2" fill="none"/><path d="M5 15 Q10 10,15 15" stroke="#60a5fa" stroke-width="2" fill="none"/>`,
      `<path d="M5 14 Q8 4,15 7 Q19 12,12 17 Q7 18,8 13" stroke="#2df3c2" stroke-width="2" fill="none"/>`,
      `<path d="M6 16 Q6 5,10 8 Q14 5,14 16" stroke="#e6b2e6b2ff" stroke-width="2" fill="none"/>`,
      `<rect x="5" y="14" width="10" height="2.5" fill="#60a5fa"/><path d="M5 14 Q10 6,15 14" stroke="#60a5fa" stroke-width="2" fill="none"/>`,
      `<path d="M6 16 V8 Q8 5,10 8 V16 M10 13 Q13 13,13 16 Q14 13,16 13" stroke="#2df3c2" stroke-width`,
      `<line x1="6" y1="14" x2="16" y2="4" stroke="#e6b2ff" stroke-width="2"/><polyline points="13,4 16,4 16,7" stroke="#e6b2ff" stroke-width="2" fill="none"/>`,
      `<path d="M6 16 Q6 8,10 12 Q14 8,14 16" stroke="#60a5fa" stroke-width="2" fill="none"/><circle cx="10" cy="12" r="1.3"" fill="none"/><polyline points="5,14 10,18 15,14" stroke="#2df3c2" stroke-width="2" fill="none"/>`,
      `<path d="M6 8 Q8 14,6 16" stroke="#e6b2ff" stroke-width="2" fill="none"/><path d="M14 8 Q12 14,14 16" stroke="#e6b2ff" stroke-width="2" fill="none"/><line x1="6" y1="12" x2="14" y2="12" stroke="#e6b2ff" stroke-width="2"/>`
    ];

    // 5. Chart Table & Wheel
    function renderTable(planets){
      const tbody=document.getElementById('tbl'); tbody.innerHTML='';
      planets.forEach(p=>{
        const zi=signOf(p.degree),zIndex=SIGNS.indexOf(zi),nIdx=nakIndex(p.degree),nak=NAKS[nIdx],pada=padaOf(p.degree),sLord=starLordOf(p.degree),sub=subLordOf(p          <td>${dms(p.degree)}</td>
          <td><svg width="23" height="18" viewBox="0 0 20 20" style="vertical-align:middle;" class="rasi-ico">${RASI_ICONS[zIndex]}</svg> <span style="color:var(--white);font-weight:600;">${zi}</span></td>
          <td>${nak}</td>
          <td>${pada}</td>
          <td>${sLord}</td>
          <td><b style="color:var(--neon2);">${sub}</b></td>`;
        tbody(tr);
      });
    }
    function renderWheel(planets){
      const W=300,H=300,Cx=W/2,Cy=H/2,R=95;
      let sectors='',labels='',icons='',planDots='';
      // Sectors
      for(let i=0;i<12;i++){
        const a1=(i*30-90)*Math.PI/180, a2=((i+1)*30-90)*Math.PI/180;
        const x1=Cx+R*Math.cos(a1), y1=Cy+R*Math.sin(a1), x2=Cx+R*Math.cos(a2),.sin(a2);
        sectors+=`<path d="M${Cx},${Cy} L${x1},${y1} A${R},${R} 0 0,1 ${x2},${y2} Z" fill="none" stroke="#1a2c44" stroke-width="2"/>`;
      }
      // Rasi icons/labels
      for(let i=0;i<12;i++){
        const a=((i*30+15)-90)*Math.PI/180, x=Cx+(R-18)*Math.cos(a), y=Cy+(R-18)*Math.sin(a);
        icons+=`<g transform="translate(${x-9},${y-8})"><svg width="18" height="15" viewBox="0 0 20 20" class="rasi-ico">${RASI_ICONS[i]}</svg></g>`;
        labels+=`<text x="${x}" y="${y+15}" font-size="10" class="rasi-label" text-anchor="middle" >${SIGNS[i]}</text>`;
      }
      // Planets
      planets.forEach(p=>{
        const a=(p.degree-90)*Math.PI/180,r=R-25,x=Cx+r*Math.cos(a),y=Cy+r*Math.sin(a);
        planDots+=`<circle cx="${x}" cy="${y}" r="7" fill="#181f2e" stroke="#60a5fa" stroke-width="2" filter="url(#glow)"/><text x="${x}" y="${y+3}" font-size=" glow filter
      const svg=`<svg viewBox="0 0 ${W} ${H}" style="background:transparent;width:240px;height:240px;">
        <defs>
          <filter id="glow"><feGaussianBlur stdDeviation="4" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <circle cx="${Cx}" cy="${Cy}" r="${R+12}" fill="rgba(7,18,34,0.98)" filter="url(#glow)"/>
       Dots}</g>
      </svg>`;
      document.getElementById('wheel').innerHTML=svg;
    }

    // 6. Form Handler (Replace with real API for actual planetary positions)
    document.getElementById('kpForm').onsubmit = async function(e){
      e.preventDefault();
      // ---- Replace this sample block with API call or library for real chart ----
      // Sample static demo planets
      const planets = [
        { "name": "Sun", "degree": 123.456 },
        { "name": "Moon", "degree": 200.123 },
        { "name": " "degree": 305.432 },
        { "name": "Rahu", "degree": 45.876 },
        { "name": "Ketu", "degree": 225.876 }
      ];
      // --- Example API call block (commented) ---
      // const dob = document.getElementById('dob').value;
      // const tob = document.getElementById('tob').value;
      // const lat = document.getElementById('lat').value;
      // const lon = document.getElementById('lon').value;
      // const tz = document.getElementById('timezone').value;
      // const}&lon=${lon}&tz=${tz}`, {
      //   headers: { 'Authorization': 'Basic '+btoa(apiKey+':') }
      // });
      // const data = await resp.json();
      // const planets = data.planets.map(p => ({ name: p.name, degree: p.longitude }));
      // --------------------------------------------------------------
      renderTable(planets);
      renderWheel(planets);
      document.getElementById('jsonPreview').value = JSON.stringify({planets}, null, 2);
      document.getElementById('status').textContent = '✓ Chart generated (demo data)';
    };

    // Initial preview (on page load)
    document.getElementById('kpForm').onsubmit(new Event('submit'));
  </script>
</body>
</html>
