<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>KP Chart Generator – Simple OSM Autocomplete Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --main-bg: #070c16;
      --panel-bg: #101823;
      --neon: #60a5fa;
      --neon2: #2df3c2;
      --serenity: #e2f0ff;
      --font-main: 'Segoe UI','Roboto',Arial,sans-serif;
      --white: #fff;
    }
    body {background:var(--main-bg);color:var(--serenity);font-family:var(--font-main);margin:0;min-height:100vh;}
    .wrap {max-width:430px;margin:36px auto;padding:20px 0 32px 0;background:var(--panel-bg);border-radius:18px;box-shadow:0 0 32px 0 #1d2537;position:relative;}
    h2 {font-weight:700;margin:13px 0 18px;font-size:1.18rem;color:var(--white);text-align:center;}
    input,select {width:98%;padding:8px 11px;border-radius:7px;border:1.5px solid #222d3f;background:#0d1321;color:var(--serenity);font-size:1rem;margin-bottom:10px;outline:none;}
    input:focus,select:focus {border:1.5px solid var(--neon2);}
    button {background:linear-gradient(90deg,var(--neon),var(--neon2));color:#070c16;border:0;border-radius:10px;padding:10px 22px;margin:10px 0;cursor:pointer;font-weight:700;letter-spacing:0.04em;font-size:1.06rem;}
    .status {font-size:14px;color:var(--neon2);margin-top:7px;min-height:20px;}
    label {font-weight:500;color:var(--white);}
    .row {display:flex;gap:10px;}
    .row>div {flex:1;}
    #pob-suggest {list-style:none;padding:0;margin:-12px 0 7px 0;background:#1a2234;position:absolute;z-index:10;max-height:120px;overflow:auto;display:none;width:92%;}
    #pob-suggest li {cursor:pointer;padding:4px 10px;}
    #pob-suggest li:hover {background:#232b47;color:var(--neon2);}
    table {width:100%;border-collapse:collapse;margin-top:18px;background:rgba(12,18,34,0.96);border-radius:10px;box-shadow:0 0 8px #23228395;padding:7px 2px;font-size:0.97rem;}
    th {color:var(--neon2);font-weight:600;background:rgba(17,25,40,0.98);}
    td {color:var(--serenity);}
    .chart-section {margin:23px 0 0 0;}
    @media (max-width:600px) {.wrap{padding:2px;max-width:99vw;}input,select{width:97vw;}}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>KP Chart Generator<br><span style="font-size:0.98rem;color:var(--neon2);">– Simple OSM Autocomplete Edition</span></h2>
    <form id="kpForm" autocomplete="off" style="position:relative;">
      <label>Name</label>
      <input type="text" id="name" required>
      <div class="row">
        <div>
          <label>Date of Birth</label>
          <input type="date" id="dob" required>
        </div>
        <div>
          <label>Time of Birth</label>
          <input type="time" id="tob" required>
        </div>
      </div>
      <label>Place of Birth</label>
      <input type="text" id="pob" placeholder="e.g. Colombo" autocomplete="off">
      <ul id="pob-suggest"></ul>
      <div class="row">
        <div>
          <label>Latitude</label>
          <input type="number" id="lat" step="0.0001" required placeholder="Auto-filled or enter">
        </div>
        <div>
          <label>Longitude</label>
          <input type="number" id="lon" step="0.0001" required placeholder="Auto-filled or enter">
        </div>
      </div>
      <label>Time Zone <button type="button" id="detectTzBtn" style="float:right;margin-top:-2px;">Auto Detect</button></label>
      <input type="text" id="timezone" required placeholder="+05:30">
      <button type="submit">Generate Chart</button>
      <div class="status" id="status"></div>
    </form>
    <div class="chart-section">
      <div id="wheel"></div>
      <table>
        <thead>
          <tr>
            <th>Planet</th><th>Degree</th><th>Sign</th><th>Nakshatra</th><th>Pada</th><th>Star Lord</th><th>Sub-Lord</th>
          </tr>
        </thead>
        <tbody id="tbl"></tbody>
      </table>
    </div>
  </div>
  <script>
    // --- OSM Autocomplete ---
    const pob = document.getElementById('pob');
    const suggest = document.getElementById('pob-suggest');
    pob.addEventListener('input', function() {
      const query = pob.value.trim();
      if (query.length < 2) { suggest.style.display = 'none'; return; }
      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(data => {
          suggest.innerHTML = '';
          data.slice(0,6).forEach(place => {
            const li = document.createElement('li');
            li.textContent = place.display_name;
            li.onclick = () => {
              pob.value = place.display_name;
              document.getElementById('lat').value = parseFloat(place.lat).toFixed(4);
              document.getElementById('lon').value = parseFloat(place.lon).toFixed(4);
              suggest.style.display = 'none';
            };
            suggest.appendChild(li);
          });
          suggest.style.display = data.length ? 'block' : 'none';
        });
    });
    document.addEventListener('click', e => {
      if (!suggest.contains(e.target) && e.target !== pob) suggest.style.display = 'none';
    });

    document.getElementById('detectTzBtn').onclick = function() {
      try {
        let offset = -new Date().getTimezoneOffset();
        let sign = offset >= 0 ? '+' : '-';
        let absOffset = Math.abs(offset);
        let hr = Math.floor(absOffset / 60);
        let min = absOffset % 60;
        let tz = `${sign}${String(hr).padStart(2,'0')}:${String(min).padStart(2,'0')}`;
        document.getElementById('timezone').value = tz;
      } catch {
        document.getElementById('timezone').value = '+05:30';
      }
    };

    // --- KP Helpers (minimal for sample, add your real logic & chart code here) ---
    function renderTable(planets){
      const tbody=document.getElementById('tbl');tbody.innerHTML='';
      if(!planets) return;
      planets.forEach(p=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td>${p.name}</td>
          <td>${Number(p.degree).toFixed(2)}</td>
          <td>${p.sign||''}</td>
          <td>${p.nakshatra||''}</td>
          <td>${p.pada||''}</td>
          <td>${p.starLord||''}</td>
          <td>${p.subLord||''}</td>`;
        tbody.appendChild(tr);
      });
    }
    function renderWheel(planets){
      // Your KP chart SVG wheel rendering here (optional)
      document.getElementById('wheel').innerHTML = '';
    }

    // --- KP Chart Form Submit (calls your backend API, you should implement this) ---
    document.getElementById('kpForm').onsubmit = async function(e){
      e.preventDefault();
      const name = document.getElementById('name').value;
      const dob = document.getElementById('dob').value;
      const tob = document.getElementById('tob').value;
      const lat = parseFloat(document.getElementById('lat').value);
      const lon = parseFloat(document.getElementById('lon').value);
      const timezone = document.getElementById('timezone').value;
      document.getElementById('status').textContent = 'Calculating...';
      // ---- CHANGE THIS: Call your planetary backend API (e.g. Node.js proxy server) ----
      try {
        // DEMO: Fake data example. Replace this with a real fetch to your server!
        // const resp = await fetch('http://localhost:3001/api/planets', { ... });
        // const data = await resp.json();
        // For demonstration, show dummy planets:
        const data = {
          planets: [
            {name:'Sun', degree:120.45, sign:'Cancer', nakshatra:'Pushya', pada:2, starLord:'Saturn', subLord:'Mercury'},
            {name:'Moon', degree:203.22, sign:'Libra', nakshatra:'Vishakha', pada:3, starLord:'Jupiter', subLord:'Venus'},
            // ...other planets
          ]
        };
        renderTable(data.planets);
        renderWheel(data.planets);
        document.getElementById('status').textContent = '✓ Chart generated!';
      } catch(e){
        document.getElementById('status').textContent = 'Error: ' + e.message;
      }
    };
  </script>
</body>
</html>
