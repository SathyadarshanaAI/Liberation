<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="utf-8">
  <title>KP Chart Generator</title>
  <meta name="viewport" content="width=600, initial-scale=1">
  <style>
    body { background: #f3f6fb; font-family: 'Segoe UI', 'Noto Sans Sinhala', Arial, sans-serif; margin: 0; }
    .container { max-width: 560px; margin: 30px auto; padding: 22px 18px 32px 18px; background: #fff; border-radius: 13px; box-shadow: 0 4px 24px #3451bf22;}
    h2 { color: #3451bf; letter-spacing:0.5px;}
    label { display: block; margin-top: 10px; margin-bottom: 2px; font-weight: 500;}
    input, select, button { width: 100%; padding: 8px 10px; margin-bottom: 10px; border-radius: 7px; border: 1px solid #dbeafe; background: #f8fafc;}
    #drawBtn { background: #3451bf; color: #fff; font-weight: 600; letter-spacing: 1px; cursor:pointer;}
    #wheelBox { display: flex; justify-content: center; margin-top: 24px; }
    #lagnaInfo {
      margin: 18px 0 0 0;
      background: #f1f5fe;
      padding: 10px 16px;
      border-radius: 8px;
      border-left: 4px solid #3451bf;
      color: #223;
      font-size: 1.12em;
      font-weight: 500;
      letter-spacing:0.2px;
      display: none;
    }
    #analysis {
      background: #f8f8fc;
      border-left: 3px solid #3451bf;
      margin-top: 22px;
      padding: 13px 15px 11px 18px;
      font-size: 1.09em;
      border-radius: 8px;
      color: #222;
      min-height: 40px;
      display:none;
    }
    .footer {
      text-align: center;
      color: #3451bf;
      font-size: 0.98em;
      letter-spacing: 1px;
      opacity: 0.85;
      margin-top: 30px;
    }
    @media(max-width:600px){
      .container{max-width:99vw;padding:4px;}
      #wheelBox svg{width:96vw!important;height:96vw!important;}
    }
  </style>
</head>
<body>
<div class="container">
  <h2>KP Chart Generator</h2>
  <form id="astroForm" autocomplete="off">
    <label>නම / Name</label>
    <input id="name" required placeholder="ජන්මියාගේ නම" />
    <label>උපන් දිනය / Date of Birth</label>
    <input id="date" type="date" required />
    <label>උපන් වේලාව / Time of Birth</label>
    <input id="time" type="time" required value="12:00" />
    <label>Latitude</label>
    <input id="lat" required placeholder="e.g. 6.9271" step="any" inputmode="decimal" />
    <label>Longitude</label>
    <input id="lon" required placeholder="e.g. 79.8612" step="any" inputmode="decimal" />
    <button id="drawBtn" type="submit">චක්‍රය ඇඳන්න / Draw Chart</button>
  </form>
  <div id="wheelBox"></div>
  <div id="lagnaInfo"></div>
  <div id="analysis"></div>
  <div class="footer">sathyadarshana astrology</div>
</div>
<script>
const samplePlanets = [
  {name:"Sun", longitude: 121.3},
  {name:"Moon", longitude: 250.9},
  {name:"Mars", longitude: 88.2},
  {name:"Mercury", longitude: 143.6},
  {name:"Venus", longitude: 44.1},
  {name:"Jupiter", longitude: 279.7},
  {name:"Saturn", longitude: 313.4},
  {name:"Uranus", longitude: 29.8},
  {name:"Neptune", longitude: 325.2},
  {name:"Pluto", longitude: 270.5},
];
// Simple Lagna calculation for demo (real: use astrology lib)
function calcLagna(date, time, lat, lon) {
  // For demo, use time to select sign
  const signs = ["Mesha","Vrushabha","Mithuna","Kataka","Sinha","Kanya","Tula","Vrischika","Dhanu","Makara","Kumbha","Meena"];
  let hour = parseInt(time.split(':')[0] || "0");
  return signs[(hour % 12)];
}
function drawKPWheelChart(planets) {
  const wheel = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  wheel.setAttribute("width", 340);
  wheel.setAttribute("height", 340);
  const cx = 170, cy = 170, rOuter = 150, rInner = 70;
  const houseColors = [
      "#f8faff", "#dbeafe", "#e0e7ff", "#f3f8fd", "#fefce8", "#f1f5f9",
      "#fdf2fa", "#f1f5f9", "#fff7ed", "#ecfdf5", "#fff1f2", "#f3f4f6"
  ];
  for(let i=0; i<12; ++i){
    const a1 = (i/12)*2*Math.PI - Math.PI/2;
    const a2 = ((i+1)/12)*2*Math.PI - Math.PI/2;
    const x1 = cx + rOuter*Math.cos(a1), y1 = cy + rOuter*Math.sin(a1);
    const x2 = cx + rOuter*Math.cos(a2), y2 = cy + rOuter*Math.sin(a2);
    const x3 = cx + rInner*Math.cos(a2), y3 = cy + rInner*Math.sin(a2);
    const x4 = cx + rInner*Math.cos(a1), y4 = cy + rInner*Math.sin(a1);
    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d",
        `M${x1},${y1} A${rOuter},${rOuter} 0 0,1 ${x2},${y2} `+
        `L${x3},${y3} A${rInner},${rInner} 0 0,0 ${x4},${y4} Z`
    );
    path.setAttribute("fill", houseColors[i]);
    path.setAttribute("stroke", "#bbb");
    path.setAttribute("stroke-width", 1);
    wheel.appendChild(path);
  }
  for(let i=0; i<12; ++i){
    let a = (i/12)*2*Math.PI - Math.PI/2 + Math.PI/12;
    let tx = cx + (rInner+45)*Math.cos(a), ty = cy + (rInner+45)*Math.sin(a)+7;
    const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
    label.setAttribute("x", tx);
    label.setAttribute("y", ty);
    label.setAttribute("class", "kp-house-label");
    label.setAttribute("text-anchor", "middle");
    label.textContent = (i+1);
    wheel.appendChild(label);
  }
  const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
  circle.setAttribute("cx", cx); circle.setAttribute("cy", cy);
  circle.setAttribute("r", rOuter); circle.setAttribute("fill", "none");
  circle.setAttribute("stroke", "#3451bf"); circle.setAttribute("stroke-width", 2);
  wheel.appendChild(circle);
  const inner = document.createElementNS("http://www.w3.org/2000/svg", "circle");
  inner.setAttribute("cx", cx); inner.setAttribute("cy", cy); inner.setAttribute("r", rInner);
  inner.setAttribute("fill", "#fff"); inner.setAttribute("stroke", "#bbb"); inner.setAttribute("stroke-width", 1.4);
  wheel.appendChild(inner);
  const planetSymbols = {
      Sun: "☉", Moon: "☽", Mercury: "☿", Venus: "♀", Mars: "♂",
      Jupiter: "♃", Saturn: "♄", Uranus: "♅", Neptune: "♆", Pluto: "♇"
  };
  if (planets && planets.length) {
      planets.forEach((pl, i)=>{
          let angle = (pl.longitude/360)*2*Math.PI - Math.PI/2;
          let px = cx + 100*Math.cos(angle), py = cy + 100*Math.sin(angle);
          const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
          const dot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          dot.setAttribute("cx", px); dot.setAttribute("cy", py);
          dot.setAttribute("r", 13); dot.setAttribute("fill", "#fff7c2");
          dot.setAttribute("stroke", "#ad8500"); dot.setAttribute("stroke-width", 1.6);
          g.appendChild(dot);
          const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
          t.setAttribute("x", px); t.setAttribute("y", py+7);
          t.setAttribute("class", "kp-planet");
          t.setAttribute("text-anchor", "middle");
          t.textContent = planetSymbols[pl.name] || pl.name[0];
          g.appendChild(t);
          const lbl = document.createElementNS("http://www.w3.org/2000/svg", "text");
          lbl.setAttribute("x", px); lbl.setAttribute("y", py+25);
          lbl.setAttribute("text-anchor", "middle");
          lbl.setAttribute("font-size", "11px");
          lbl.setAttribute("fill", "#222");
          lbl.textContent = pl.name;
          g.appendChild(lbl);
          wheel.appendChild(g);
      });
  }
  document.getElementById('wheelBox').innerHTML = '';
  document.getElementById('wheelBox').appendChild(wheel);
}
function getPlanetAnalysis(formData, planets, lagna) {
  let txt = `<b>${formData.name || 'පරිශීලක'}ගේ KP චාටි විස්තරය:</b><br><br>`;
  if (!planets) {
      txt += "ග්‍රහ තොරතුරු ලබාගත නොහැක.";
      return txt;
  }
  txt += `<b>ජන්ම ලග්නය (Ascendant):</b> <span style="font-size:1.12em;color:#3451bf;font-weight:600;">${lagna}</span><br>`;
  txt += `<br><b>ප්‍රධාන ග්‍රහ පිහිටීම:</b><br>`;
  planets.forEach(pl => {
    txt += `<b>${pl.name}</b>: ${pl.longitude.toFixed(2)}°<br>`;
  });
  txt += `<br>
  <b>KP Astrology කෙටි විස්තරය:</b><br>
  - <b>Sun</b>: ආත්ම ශක්තිය, අභිප්‍රේරණය.<br>
  - <b>Moon</b>: මනෝභාවය.<br>
  - <b>Venus</b>: ආදරය, රූපලාවණ්‍යය.<br>
  - <b>Mars</b>: ශක්තිමත් වීම, ක්‍රියාශීලීත්වය.<br>
  - <b>Mercury</b>: බුද්ධිය, සන්නිවේදනය.<br>
  <br>
  ඔබගේ ලග්නය හා ග්‍රහ පිහිටීම අනුව, ජීවිතයේ විවිධ අවස්ථාවන්හිදී ඔබට යහපත් අවස්ථා හා අභියෝග පැමිණිය හැක.<br>
  <i>මෙය KP ජ්‍යෝතිෂය අනුව ස්වයංක්‍රීය විශ්ලේෂණයකි.</i>
  `;
  return txt;
}
document.getElementById('astroForm').onsubmit = function(e){
  e.preventDefault();
  const formData = {
    name: document.getElementById('name').value.trim(),
    date: document.getElementById('date').value,
    time: document.getElementById('time').value,
    lat: document.getElementById('lat').value,
    lon: document.getElementById('lon').value
  };
  const planets = samplePlanets; // Replace with real data if needed
  drawKPWheelChart(planets);

  // Lagna calculation
  const lagna = calcLagna(formData.date, formData.time, formData.lat, formData.lon);
  document.getElementById('lagnaInfo').innerHTML = `ජන්ම ලග්නය (Ascendant): <span style="color:#3451bf;font-weight:600;">${lagna}</span>`;
  document.getElementById('lagnaInfo').style.display = '';
  // Analysis
  document.getElementById('analysis').innerHTML = getPlanetAnalysis(formData, planets, lagna);
  document.getElementById('analysis').style.display = '';
};
</script>
</body>
</html>
