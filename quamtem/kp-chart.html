<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>KP Chart</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; background: #f8fafc; color: #222;}
    .container { max-width: 560px; margin: 24px auto; padding: 16px; background: #fff; border-radius: 10px; box-shadow:0 2px 12px #0001;}
    label { display: block; margin-top: 8px; margin-bottom: 2px;}
    input, select, button { width: 100%; padding: 7px; margin-bottom: 10px;}
    #wheelBox { display: flex; justify-content: center; margin-top: 24px; }
    #mapPreview { width: 100%; height: 170px; border: 1px solid #bbb; border-radius: 8px; margin-bottom: 14px; display: none;}
    #mapPreview iframe { width:100%; height:100%; border:0; border-radius:8px;}
    @media(max-width:600px){
      .container{max-width:98vw;padding:4px;}
      #mapPreview{height:120px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>KP Chart</h2>
    <form id="form">
      <label>Name</label>
      <input id="name" required placeholder="Your name"/>

      <label>Date of Birth</label>
      <input id="date" type="date" required/>

      <label>Time of Birth</label>
      <input id="time" type="time" required value="12:00"/>

      <label>Timezone</label>
      <select id="timezone"></select>

      <label>Latitude</label>
      <input id="lat" required placeholder="e.g. 51.5074" step="any" inputmode="decimal"/>
      <label>Longitude</label>
      <input id="lon" required placeholder="e.g. -0.1278" step="any" inputmode="decimal"/>

      <label>Place</label>
      <div style="display:flex;gap:4px;">
        <input id="place" placeholder="e.g. London, UK" style="flex:1"/>
        <button type="button" id="geocodeBtn" style="width:auto;">Find</button>
      </div>
    </form>
    <div id="mapPreview"></div>
    <button id="drawBtn" style="margin-top:10px;width:100%;">Draw Chart</button>
    <div id="wheelBox"></div>
  </div>
<script>
// ---- Timezone select ----
const timezones = [
  { value:"+05:30", label:"IST (India/Sri Lanka) +05:30" },
  { value:"+06:00", label:"Bangladesh +06:00" },
  { value:"+05:45", label:"Nepal +05:45" },
  { value:"+01:00", label:"CET +01:00" },
  { value:"-05:00", label:"EST (US East) -05:00" },
  { value:"+09:00", label:"Japan +09:00" },
  { value:"+03:00", label:"Arabia +03:00" },
  { value:"+08:00", label:"China +08:00" },
  { value:"-08:00", label:"PST (US West) -08:00" },
  { value:"+00:00", label:"UTC/GMT +00:00" }
];
const tzSel = document.getElementById('timezone');
timezones.forEach(tz=>{
  const o = document.createElement('option');
  o.value = tz.value; o.textContent = tz.label;
  tzSel.appendChild(o);
});
tzSel.value = "+00:00"; // Default London

// ---- Map view logic ----
async function geocodePlace(q){
  const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1`;
  const res = await fetch(url).then(r=>r.json());
  if(!res.length) return null;
  return { lat:+res[0].lat, lon:+res[0].lon, label:res[0].display_name };
}
function showMap(lat, lon){
  const mapDiv = document.getElementById('mapPreview');
  if(!lat||!lon){ mapDiv.style.display='none'; return; }
  mapDiv.style.display = '';
  mapDiv.innerHTML = `<iframe loading="lazy" allowfullscreen
    src="https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.02}%2C${lat-0.01}%2C${lon+0.02}%2C${lat+0.01}&layer=mapnik&marker=${lat}%2C${lon}"></iframe>
    <div style="text-align:right;font-size:12px;margin-top:2px;">
      <a href="https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}" target="_blank">View Full Map</a>
    </div>`;
}
document.getElementById('geocodeBtn').onclick = async function(){
  const place = document.getElementById('place').value.trim();
  if(!place){ alert("Enter place name."); return; }
  const geo = await geocodePlace(place);
  if(!geo){
    alert("Place not found. Try a more specific name.");
    return;
  }
  document.getElementById('lat').value = geo.lat;
  document.getElementById('lon').value = geo.lon;
  showMap(geo.lat, geo.lon);
};
// On Lat/Lon change, show map preview
document.getElementById('lat').addEventListener('input', ()=>{
  const lat=document.getElementById('lat').value,lon
