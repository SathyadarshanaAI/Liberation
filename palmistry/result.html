<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Palmistry · Results & Reports</title>
<style>
:root{--bg:#0b0f16;--pri:#16f0a7;--neon:#00e5ff;--card:#101820}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:#e6f0ff;font-family:system-ui}
h1{text-align:center;color:var(--neon);margin:16px 0 8px}
nav{display:flex;justify-content:center;gap:10px;margin-bottom:12px;flex-wrap:wrap}
a.btn{background:#111;color:#00e5ff;border:1px solid #00e5ff;border-radius:16px;padding:8px 14px;
      text-decoration:none;font-weight:600;transition:.25s}
a.btn:hover{background:#00e5ff;color:#000}
.container{max-width:800px;margin:0 auto;padding:10px}
.card{background:var(--card);border:1px solid #0aefff33;border-radius:14px;padding:12px;margin:10px 0}
.row{display:flex;gap:10px;flex-wrap:wrap}
.meta{font-size:13px;opacity:.9;margin-bottom:6px}
.actions{display:flex;gap:8px;flex-wrap:wrap}
button{border:none;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer}
.btn-dl{background:#00e5ff;color:#000}
.btn-del{background:#2a2a2a;color:#ffd4d4;border:1px solid #ff7a7a55}
.empty{opacity:.8;text-align:center;margin:30px 0}
footer{text-align:center;margin:18px 0;opacity:.75}
</style>
</head>
<body>
<h1>Results & Reports</h1>
<nav>
  <a href="index.html" class="btn">Lab Home</a>
  <a href="palmistry_photo.html" class="btn">Photo Analyzer</a>
  <a href="detect.html" class="btn">AI Detection</a>
</nav>

<div class="container">
  <div class="actions" style="justify-content:flex-end;margin-bottom:8px">
    <button id="exportAll" class="btn-dl">Export JSON</button>
    <button id="clearAll" class="btn-del">Clear All</button>
  </div>
  <div id="list"></div>
</div>

<footer><small>© 2025 Sathyadarshana · Palmistry Research Division</small></footer>

<script>
const KEY='palmistryResults';
const list=document.getElementById('list');

function load(){ return JSON.parse(localStorage.getItem(KEY)||'[]'); }
function save(a){ localStorage.setItem(KEY, JSON.stringify(a)); }

function fmt(ts){
  const d=new Date(ts);
  const pad=n=>String(n).padStart(2,'0');
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
}

function render(){
  const data=load();
  list.innerHTML='';
  if(!data.length){
    list.innerHTML=`<div class="empty">No results yet. Run an analysis in the Photo Analyzer.</div>`;
    return;
  }
  data.forEach((r,idx)=>{
    const hand = r.hand ? (r.hand[0].toUpperCase()+r.hand.slice(1)) : '—';
    const meta = r.meta?.version ? `v${r.meta.version}` : 'v?';
    const card=document.createElement('div'); card.className='card';

    const blocks=[];
    // meta
    blocks.push(`<div class="meta"><b>${hand} Hand</b> · ${fmt(r.ts)} · ${meta}</div>`);

    // >>> THUMBNAIL (NEW)
    if (r.thumb){
      blocks.push(`<div style="margin:6px 0">
        <img src="${r.thumb}" alt="thumb"
             style="width:120px;border-radius:10px;border:1px solid #0ff3"/>
      </div>`);
    }
    // <<< THUMBNAIL

    // reportHTML or fallback
    if (r.reportHTML){
      blocks.push(`<div class="report">${r.reportHTML}</div>`);
    } else {
      const L=r.lines||{};
      blocks.push(`<ul style="margin:6px 0 2px 16px;line-height:1.5">
        <li>Heart: ${L.heart?.score?.toFixed?.(2) ?? '—'}</li>
        <li>Head: ${L.head?.score?.toFixed?.(2) ?? '—'}</li>
        <li>Life: ${L.life?.len?.toFixed?.(2) ?? '—'}</li>
        <li>Fate: ${L.fate?.score?.toFixed?.(2) ?? '—'}</li>
        <li>Sun: ${L.sun?.intensity?.toFixed?.(2) ?? '—'}</li>
        <li>Mercury: ${L.mercury?.score?.toFixed?.(2) ?? '—'}</li>
        <li>Marriage: ${L.marriage?.score?.toFixed?.(2) ?? '—'}</li>
      </ul>`);
    }

    const id=`dl-${idx}`;
    blocks.push(`<div class="row actions">
      <button class="btn-dl" id="${id}">Download JSON</button>
      <button class="btn-del" data-i="${idx}">Delete</button>
    </div>`);

    card.innerHTML = blocks.join('');
    list.appendChild(card);

    document.getElementById(id).onclick=()=>downloadOne(r, idx);
    card.querySelector('.btn-del').onclick=()=>{ const a=load(); a.splice(idx,1); save(a); render(); };
  });
}

function downloadOne(obj, idx){
  const blob=new Blob([JSON.stringify(obj,null,2)],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=`palmistry_result_${idx+1}.json`;
  a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href),1000);
}

document.getElementById('exportAll').onclick=()=>{
  const blob=new Blob([JSON.stringify(load(),null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download='palmistry_results_all.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),1000);
};
document.getElementById('clearAll').onclick=()=>{
  if(!confirm('Delete all saved results?')) return;
  localStorage.removeItem(KEY); render();
};

render();
</script>
</body>
</html>
