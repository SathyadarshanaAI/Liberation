<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sathyadarshana ¬∑ Quantum Palm Analyzer ¬∑ True Vision v2.2.2</title>
<link rel="icon" href="./assets/icon.png">
<style>
:root{
  --bg:#0b0f16;--card:#101820;--neon:#00e5ff;--pri:#16f0a7;
}
body{
  margin:0;background:var(--bg);color:#e6f0ff;
  font-family:'Segoe UI',sans-serif;text-align:center;
}
h1{
  color:var(--neon);
  text-shadow:0 0 12px var(--neon);
  margin:16px 0;
}
#view{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin:20px}
.camBox{
  background:var(--card);
  border-radius:16px;
  padding:12px;
  width:90%;
  max-width:360px;
  box-shadow:0 0 10px #0007;
}
video,canvas{width:100%;border-radius:12px;}
button{
  background:var(--neon);color:#000;padding:8px 20px;margin:8px;
  border:none;border-radius:10px;font-weight:bold;cursor:pointer;
  box-shadow:0 0 10px var(--neon);
  transition:0.3s;
}
button:hover{box-shadow:0 0 20px var(--pri);}
#msg{margin-top:10px;color:#16f0a7}
.error{color:#ff6b6b}
input,select{
  width:90%;padding:8px;margin:6px 0;
  border-radius:8px;border:1px solid #16f0a7;
  background:#0b0f16;color:#e6f0ff;text-align:center;
}
small{color:#aaa;}
</style>
</head>
<body>
<h1>üñêÔ∏è Sathyadarshana Quantum Palm Analyzer ¬∑ True Vision v2.2.2</h1>

<div id="view">
  <div class="camBox">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" hidden></canvas>

    <div id="userForm">
      <input id="userName" placeholder="Full Name">
      <input id="userDOB" type="date">
      <input id="userNIC" placeholder="National ID / Passport No.">
      <select id="userGender">
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
    </div>

    <div>
      <button id="startBtn">üì∑ Start Camera</button>
      <button id="captureBtn">üîç Capture Palm</button>
    </div>
    <p id="msg">Awaiting camera...</p>
  </div>
</div>

<script type="module">
const video=document.getElementById('video');
const canvas=document.getElementById('canvas');
const msg=document.getElementById('msg');
let stream=null;

document.getElementById('startBtn').onclick=async()=>{
  try{
    stream=await navigator.mediaDevices.getUserMedia({
      video:{facingMode:"environment"}
    });
    video.srcObject=stream;
    msg.textContent="‚úÖ Camera active. Place your hand in bright light.";
    msg.className="";
  }catch(e){
    msg.textContent="‚ö†Ô∏è Camera permission denied: "+e.message;
    msg.className="error";
  }
};

document.getElementById('captureBtn').onclick=()=>{
  if(!stream){
    msg.textContent="‚ö†Ô∏è Please start camera first.";
    msg.className="error";
    return;
  }

  const ctx=canvas.getContext('2d');
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  const imgData=ctx.getImageData(0,0,canvas.width,canvas.height);

  const clarity=checkClarity(imgData);

  if(clarity<0.25){
    msg.innerHTML="‚ö†Ô∏è Palm lines not clear. Please recapture in better light or focus.";
    msg.className="error";
    return;
  }

  // --- user details ---
  const name=document.getElementById("userName").value.trim()||"Unknown";
  const dob=document.getElementById("userDOB").value||"N/A";
  const nic=document.getElementById("userNIC").value.trim()||"N/A";
  const gender=document.getElementById("userGender").value||"N/A";

  msg.innerHTML=`
    ‚úÖ Palm captured successfully.<br>
    <small>${name}, ${gender}, DOB: ${dob}, ID: ${nic}</small><br>
    Preparing for AI analysis...
  `;
  msg.className="";

  // --- Save frame (optional for AI pipeline) ---
  const frame=canvas.toDataURL("image/png");
  localStorage.setItem("lastPalm", frame);
  localStorage.setItem("userData", JSON.stringify({name,dob,nic,gender}));
};

// --- Simple clarity estimator ---
function checkClarity(img){
  let diff=0,count=0;
  for(let i=0;i<img.data.length;i+=40){
    const l1=0.299*img.data[i]+0.587*img.data[i+1]+0.114*img.data[i+2];
    const l2=0.299*img.data[i+4]+0.587*img.data[i+5]+0.114*img.data[i+6];
    diff+=Math.abs(l1-l2);count++;
  }
  return Math.min(diff/count/50,1);
}
</script>
</body>
</html>
