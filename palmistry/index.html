<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <base href="/Liberation/palmistry/" />
  <title>Sathyadarshana Palmistry Lab ¬∑ Research AI</title>

  <!-- Block all hardware permissions on HOME (safety) -->
  <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()" />

  <link rel="icon" href="favicon.png" />
  <style>
    :root{--bg:#0b0f16;--card:#101820;--text:#e6f0ff;--pri:#16f0a7;--neon:#00e5ff;--mut:#92a3b6}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial}
    h1{margin:18px 0 6px;text-align:center;font-weight:800}
    .brand{display:flex;gap:10px;align-items:center;justify-content:center}
    .brand .emoji{font-size:28px}
    .badge{display:inline-flex;gap:8px;align-items:center;background:#0d1722;border:1px solid #0aefff40;
           color:#bfeaff;padding:6px 10px;border-radius:999px;font-size:12px;margin:8px auto 0}
    .badge b{color:#00e5ff}
    nav{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:12px 0}
    a.btn{background:#111;border:1px solid var(--neon);color:var(--text);text-decoration:none;
          border-radius:16px;padding:10px 16px;font-weight:700}
    a.btn:hover{background:var(--neon);color:#000}
    .grid{max-width:980px;margin:14px auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;padding:0 10px}
    .card{background:var(--card);border:1px solid #0aefff30;border-radius:16px;padding:14px;box-shadow:0 0 10px #0aefff20}
    .card h3{margin:0 0 8px;color:var(--pri)}
    .muted{color:var(--mut)}
    .list{margin:0;padding-left:18px;line-height:1.6}
    footer{margin:22px 0 28px;text-align:center;color:#9db0c6}
    .ok{color:#00e887}.warn{color:#ffd24d}.err{color:#ff9b9b}
    .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #1e2b36;border-radius:999px;padding:6px 10px;background:#0e1620}
    .row{display:flex;gap:8px;flex-wrap:wrap}
  </style>
</head>
<body>

  <!-- Brand + version -->
  <div class="brand">
    <div class="emoji">üîÆ</div>
    <h1>Sathyadarshana Palmistry Lab</h1>
  </div>
  <div id="verBadge" class="badge">Loading <b>version‚Ä¶</b></div>

  <!-- Primary nav (UPDATED ORDER) -->
  <nav>
    <a href="palmistry_photo.html" class="btn">Photo Analyzer</a>
    <a href="detect.html" class="btn">AI Detection</a>
    <a href="result.html" class="btn">Results & Reports</a>
    <a href="compare.html" class="btn">Compare Hands</a>
  </nav>

  <!-- Cards -->
  <section class="grid">

    <div class="card">
      <h3>About the Lab</h3>
      <p>
        A research-grade project uniting ancient <i>Hasta Sastra</i> with modern
        computer-vision & AI. Capture palms, highlight 7 lines, and interpret with the KP model.
      </p>
      <ul class="list">
        <li>üì∏ Real-time or Photo-mode analysis (Edge-safe)</li>
        <li>üåà 7-line color classification</li>
        <li>üß† KP Astrology integration (module design)</li>
        <li>üìú Insight reports (PDF export)</li>
        <li>üì¶ Offline friendly (SW cache)</li>
      </ul>
    </div>

    <div class="card">
      <h3>Quick Start</h3>
      <ol class="list">
        <li>Open <b>Photo Analyzer</b> ‚Üí choose Left/Right ‚Üí Pick Photo or Take Photo.</li>
        <li>Press <b>Analyze</b> to draw lines. Tune threshold slider if needed.</li>
        <li>Save results ‚Üí see them in <b>Results & Reports</b>.</li>
      </ol>
      <p class="muted">Tip: On some devices other apps lock the camera. Photo-mode works 100%.</p>
    </div>

    <div class="card">
      <h3>System</h3>
      <div class="row">
        <span id="upStatus" class="pill"><span>üîÑ</span><span>Updater</span></span>
        <span id="swStatus" class="pill"><span>üì¶</span><span>Service Worker</span></span>
        <span id="permNote" class="pill"><span>üîê</span><span>No camera on home</span></span>
      </div>
      <div style="height:8px"></div>
      <button id="checkUpdate" class="btn">Check for Updates</button>
      <p id="sysMsg" class="muted" style="margin-top:8px">‚Äî</p>
    </div>

    <div class="card">
      <h3>Roadmap</h3>
      <ul class="list">
        <li>Edge-detector tuning per ROI (manifest-driven)</li>
        <li>Landmark dataset & evaluator (anonymous)</li>
        <li>KP sub-lord correlation explorer</li>
        <li>Model plug-ins via <code>modules/</code></li>
      </ul>
    </div>

  </section>

  <footer>
    ¬© 2025 Sathyadarshana ¬∑ Research Build <span id="vFooter">v‚Äî</span> ¬∑ Works Offline
  </footer>

  <!-- Lab core init (version + updater + SW) -->
  <script type="module">
    // Minimal bootstrap without touching camera.
    async function loadJSON(url){
      const r = await fetch(url, {cache:"no-store"});
      if(!r.ok) throw new Error("fetch "+url);
      return r.json();
    }

    const verBadge = document.getElementById('verBadge');
    const vFooter  = document.getElementById('vFooter');
    const upStatus = document.getElementById('upStatus');
    const swStatus = document.getElementById('swStatus');
    const sysMsg   = document.getElementById('sysMsg');

    // 1) Version from manifest.json
    try{
      const mf = await loadJSON('manifest.json'); // palmistry/manifest.json
      const v = mf.version || 'dev';
      verBadge.innerHTML = `Palmistry Module <b>v${v}</b>`;
      vFooter.textContent = 'v' + v;
    }catch(e){
      verBadge.innerHTML = `<span class="err">Manifest load failed</span>`;
    }

    // 2) Updater (core/updater.js optional)
    try{
      const up = await import('./core/updater.js').catch(()=>null);
      if(up && up.checkForUpdate){
        upStatus.classList.add('ok');
        document.getElementById('checkUpdate').onclick = async ()=>{
          sysMsg.textContent = 'Checking‚Ä¶';
          const res = await up.checkForUpdate().catch(err=>({ok:false,error:String(err)}));
          if(res?.ok){
            sysMsg.innerHTML = 'Update ready. <b>Hard refresh</b> suggested.';
          }else{
            sysMsg.textContent = res?.error ? ('No update: '+res.error) : 'No update found.';
          }
        };
      }else{
        upStatus.classList.add('warn');
        sysMsg.textContent = 'Updater module not found (optional).';
      }
    }catch{
      upStatus.classList.add('warn');
      sysMsg.textContent = 'Updater init skipped.';
    }

    // 3) Service Worker status (sw.js already in repo)
    if('serviceWorker' in navigator){
      try{
        await navigator.serviceWorker.register('./sw.js');
        swStatus.classList.add('ok');
        sysMsg.textContent = 'Offline cache active.';
      }catch{
        swStatus.classList.add('err');
        sysMsg.textContent = 'Service worker failed to register.';
      }
    }else{
      swStatus.classList.add('warn');
    }
  </script>
</body>
</html>
