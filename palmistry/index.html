<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üïâÔ∏è Sathyadarshana Quantum Palm Analyzer ¬∑ V27.0 TruePalm AI Edition</title>
<link rel="icon" type="image/png" href="assets/logo.png" />
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
<style>
  body{background:#0b0f16;color:#e6f0ff;font-family:'Segoe UI',sans-serif;text-align:center;margin:0}
  h1{color:#00e5ff;text-shadow:0 0 15px #00e5ff;margin:16px 0;font-size:1.3rem}
  .wrap{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;padding:20px}
  .camCol{background:#101820;padding:18px;border-radius:16px;box-shadow:0 0 15px #00e5ff22;width:320px}
  video,canvas{width:280px;height:360px;border-radius:10px;background:#000;display:block;margin:0 auto 8px}
  button{margin:5px;padding:8px 14px;background:#00e5ff22;color:#00e5ff;border:1px solid #00e5ff;border-radius:8px;cursor:pointer;transition:0.3s}
  button:hover{background:#00e5ff55}
  select{background:#111a22;color:#00e5ff;border:1px solid #00e5ff;border-radius:8px;padding:6px;margin-bottom:6px}
  #status{margin-top:10px;color:#FFD700;text-shadow:0 0 8px #FFD700}
  pre{background:#0f1a24;border-radius:8px;padding:10px;color:#9be7ff;text-align:left;font-size:0.8rem;overflow-x:auto}
</style>
</head>
<body>
<h1>üïâÔ∏è Sathyadarshana Quantum Palm Analyzer ¬∑ V27.0 TruePalm AI Edition</h1>
<p id="status">üß† Initializing System...</p>

<div class="wrap">
  <!-- LEFT HAND -->
  <div class="camCol">
    <h3>‚úã Left Hand</h3>
    <select id="cameraSelectLeft"></select>
    <video id="vidLeft" autoplay playsinline muted></video>
    <canvas id="canvasLeft" width="280" height="360" style="display:none;"></canvas>
    <div>
      <button id="startCamLeft">Start Camera</button>
      <button id="captureLeft">Capture</button>
      <button id="analyzeLeft">Analyze Palm</button>
    </div>
    <h4>Mini Report</h4>
    <pre id="miniReportLeft"></pre>
    <h4>Deep Report</h4>
    <pre id="deepReportLeft"></pre>
  </div>

  <!-- RIGHT HAND -->
  <div class="camCol">
    <h3>ü§ö Right Hand</h3>
    <select id="cameraSelectRight"></select>
    <video id="vidRight" autoplay playsinline muted></video>
    <canvas id="canvasRight" width="280" height="360" style="display:none;"></canvas>
    <div>
      <button id="startCamRight">Start Camera</button>
      <button id="captureRight">Capture</button>
      <button id="analyzeRight">Analyze Palm</button>
    </div>
    <h4>Mini Report</h4>
    <pre id="miniReportRight"></pre>
    <h4>Deep Report</h4>
    <pre id="deepReportRight"></pre>
  </div>
</div>

<script async src="https://docs.opencv.org/4.x/opencv.js"
  onload="console.log('‚úÖ OpenCV Loaded');document.getElementById('status').textContent='üîç OpenCV Ready';">
</script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>

<script type="module">
import { detectPalmEdges } from './js/edgeLines.js';

const hands = ["left","right"];
let streams = {};

for (const side of hands) {
  const video = document.getElementById(`vid${cap(side)}`);
  const canvas = document.getElementById(`canvas${cap(side)}`);
  const ctx = canvas.getContext("2d");
  const selectEl = document.getElementById(`cameraSelect${cap(side)}`);
  
  // list cameras
  navigator.mediaDevices.enumerateDevices().then(devices=>{
    selectEl.innerHTML="";
    devices.filter(d=>d.kind==="videoinput").forEach(cam=>{
      const opt=document.createElement("option");
      opt.value=cam.deviceId;
      opt.textContent=cam.label||`Camera ${selectEl.length+1}`;
      selectEl.appendChild(opt);
    });
  });

  // start camera
  document.getElementById(`startCam${cap(side)}`).onclick=async()=>{
    const deviceId=selectEl.value;
    try{
      const stream=await navigator.mediaDevices.getUserMedia({video:{deviceId}});
      video.srcObject=stream;
      streams[side]=stream;
      document.getElementById("status").textContent=`üì∑ ${side.toUpperCase()} camera running`;
    }catch(e){alert("Camera error: "+e.message);}
  };

  // capture freeze
  document.getElementById(`capture${cap(side)}`).onclick=()=>{
    if(!streams[side])return alert("Start camera first!");
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    canvas.style.display="block";
    video.pause();
    document.getElementById("status").textContent=`üì∏ ${side} captured`;
  };

  // analyze
  document.getElementById(`analyze${cap(side)}`).onclick=async()=>{
    document.getElementById("status").textContent=`üß† Analyzing ${side} hand...`;
    const frame=ctx.getImageData(0,0,canvas.width,canvas.height);
    const edges=await detectPalmEdges(frame,canvas);

    // simple mock AI text (later plug your real model)
    const mini=`Life line clear\nHeart line curved\nFate line medium strength`;
    const deep=`Detailed palm interpretation indicates balanced emotional and physical state.\nPotential leadership and creativity seen in line junctions.`;
    document.getElementById(`miniReport${cap(side)}`).textContent=mini;
    document.getElementById(`deepReport${cap(side)}`).textContent=deep;
    speak(`Your ${side} hand shows calm energy and clarity of purpose.`);

    document.getElementById("status").textContent="‚ú® AI Analysis complete!";
  };
}

function cap(s){return s.charAt(0).toUpperCase()+s.slice(1);}
function speak(txt){
  if(!window.speechSynthesis)return;
  const u=new SpeechSynthesisUtterance(txt);
  u.lang="en-US"; u.pitch=1; u.rate=1;
  speechSynthesis.speak(u);
}
</script>
</body>
</html>
