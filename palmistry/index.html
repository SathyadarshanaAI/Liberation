<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Quantum Palm Analyzer v4.3.1</title>
<style>
:root{--bg:#0b0f16;--card:#0f172a;--neon:#00e5ff;--pri:#16f0a7;--mut:#a9c2da}
*{box-sizing:border-box}
body{margin:0;background:radial-gradient(1200px 800px at 50% -10%,#0e2133,#0b0f16);
  color:#e6f0ff;font-family:system-ui,Segoe UI,Inter,Arial}
h1{margin:12px 0 6px;text-align:center;color:var(--neon)}
.wrap{max-width:960px;margin:0 auto;padding:10px}
.btn,button,a{background:#0d1522;color:#c7e8ff;border:1px solid #1a3a55;border-radius:22px;
  padding:12px 16px;font-weight:800;cursor:pointer;text-decoration:none;
  display:inline-flex;gap:8px;align-items:center}
.btn:hover,button:hover,a:hover{background:#00e5ff;color:#001015;border-color:#00e5ff}
.toolbar{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:8px 0 12px}
.camWrap{display:grid;place-items:center}
.camBox{position:relative;width:min(96vw,720px);aspect-ratio:3/4;border-radius:16px;
  border:2px solid #00d0ff;overflow:hidden;background:#000}
.camBox video,.camBox canvas,.camBox .aura{position:absolute;inset:0;width:100%;
  height:100%;object-fit:cover;border-radius:16px}
#video[hidden]{display:none}
.aura{mix-blend-mode:screen;background:conic-gradient(from 0deg,#00e5ff88,#16f0a788,#9a6bff88,#00e5ff88);
  animation:spin 6s linear infinite;opacity:.7}
@keyframes spin{to{transform:rotate(360deg)}}
.card{background:linear-gradient(180deg,#101a2b,#0c1320);border:1px solid #133149;
  border-radius:16px;padding:14px;margin-top:12px}
.lines{display:grid;grid-template-columns:1fr;gap:8px}
.row{display:grid;grid-template-columns:260px 1fr;gap:10px;align-items:center}
.label{display:flex;align-items:center;gap:8px;font-weight:600;color:#d7e8ff}
.sw{width:14px;height:14px;border-radius:4px;display:inline-block}
.bar{background:#0b1320;height:12px;border-radius:10px;overflow:hidden}
.bar>span{display:block;height:100%;transform-origin:left center;
  transform:scaleX(0);transition:transform 900ms ease}
.bar.h>span{background:linear-gradient(90deg,#ff6b6b,#ff3b3b)}
.bar.hh>span{background:linear-gradient(90deg,#60a5fa,#3b82f6)}
.bar.l>span{background:linear-gradient(90deg,#34d399,#10b981)}
.bar.f>span{background:linear-gradient(90deg,#f59e0b,#fbbf24)}
.bar.s>span{background:linear-gradient(90deg,#f97316,#fb923c)}
.bar.hl>span{background:linear-gradient(90deg,#a78bfa,#8b5cf6)}
.bar.mar>span{background:linear-gradient(90deg,#f472b6,#ec4899)}
#radar{display:block;margin:10px auto;background:#0b1320;border:1px solid #17324a;
  border-radius:12px}
</style>
</head>
<body>
<h1>Quantum Palm Analyzer v4.3.1</h1>

<div class="toolbar">
  <a class="btn" href="../astrology.html">‚Üê Back</a>
  <button class="btn" id="startCam">üì∑ Start Camera</button>
  <button class="btn" id="capture">Capture</button>
  <label class="btn" for="filePick">Upload Photo</label>
  <input id="filePick" type="file" accept="image/*" hidden/>
  <button class="btn" id="analyze">Analyze</button>
  <button class="btn" id="dlPdf">‚¨áÔ∏è Download Full Report (PDF)</button>
</div>

<div class="wrap">
  <div class="card">
    <div class="camWrap">
      <div class="camBox" id="camBox">
        <video id="video" playsinline autoplay muted hidden></video>
        <canvas id="canvas"></canvas>
        <div class="aura"></div>
      </div>
    </div>
    <div style="text-align:center;margin-top:6px" id="status">No image yet</div>
  </div>

  <div class="card">
    <div class="badge" id="conf">Confidence ‚Äî</div>
    <div class="lines">
      <div class="row"><div class="label"><span class="sw h"></span>Heart line</div><div class="bar h"><span id="b0"></span></div></div>
      <div class="row"><div class="label"><span class="sw hh"></span>Mind line</div><div class="bar hh"><span id="b1"></span></div></div>
      <div class="row"><div class="label"><span class="sw l"></span>Life line</div><div class="bar l"><span id="b2"></span></div></div>
      <div class="row"><div class="label"><span class="sw f"></span>Fate line</div><div class="bar f"><span id="b3"></span></div></div>
      <div class="row"><div class="label"><span class="sw s"></span>Success line</div><div class="bar s"><span id="b4"></span></div></div>
      <div class="row"><div class="label"><span class="sw hl"></span>Health line</div><div class="bar hl"><span id="b5"></span></div></div>
      <div class="row"><div class="label"><span class="sw mar"></span>Marriage line</div><div class="bar mar"><span id="b6"></span></div></div>
    </div>
  </div>

  <div class="card">
    <canvas id="radar" width="320" height="240"></canvas>
    <pre id="insight" style="white-space:pre-wrap;text-align:left;margin:6px auto;max-width:720px">
üúÅ Run Analyze to generate insight‚Ä¶
    </pre>
  </div>
</div>

<script>
const video=document.getElementById('video');
const canvas=document.getElementById('canvas');const ctx=canvas.getContext('2d');
const camBox=document.getElementById('camBox');const statusBox=document.getElementById('status');
function sizeCanvas(){const r=camBox.getBoundingClientRect();
 const d=Math.min(window.devicePixelRatio||1,2);
 canvas.width=r.width*d;canvas.height=r.height*d;}
new ResizeObserver(sizeCanvas).observe(camBox);sizeCanvas();

document.getElementById('startCam').onclick=async()=>{
 try{const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
 video.srcObject=stream;video.hidden=false;statusBox.textContent='Camera active';}
 catch{alert('Camera access failed');}
};
document.getElementById('capture').onclick=()=>{
 if(!video.srcObject){alert('Start camera first');return;}
 sizeCanvas();ctx.drawImage(video,0,0,canvas.width,canvas.height);
 statusBox.textContent='Frame captured';
};
document.getElementById('filePick').onchange=e=>{
 const f=e.target.files[0];if(!f)return;
 const img=new Image();img.onload=()=>{
   sizeCanvas();ctx.drawImage(img,0,0,canvas.width,canvas.height);
   statusBox.textContent='Image loaded';};
 img.src=URL.createObjectURL(f);
};

// ----- Analyzer -----
let lastResult=null;
const bars=[...Array(7)].map((_,i)=>document.getElementById('b'+i));
document.getElementById('analyze').onclick=()=>{
 const pix=ctx.getImageData(0,0,canvas.width,canvas.height).data;
 if(!pix||!pix.length){alert('Load an image first');return;}
 let sum=0;for(let i=0;i<pix.length;i+=24)sum+=pix[i]+pix[i+1]+pix[i+2];
 const avg=sum/(pix.length/24);const conf=Math.min(99,Math.max(60,avg/4));
 document.getElementById('conf').textContent='Confidence '+conf.toFixed(1)+'%';
 const sc=[80,74,70,60,66,75,55].map(v=>Math.min(100,v+(conf-80)/2));
 sc.forEach((v,i)=>bars[i].style.transform=`scaleX(${v/100})`);
 drawRadar(sc);
 lastResult={confidence:conf,lines:sc};
 document.getElementById('insight').textContent=
   `Confidence: ${conf.toFixed(1)}%
Heart ${sc[0]} | Mind ${sc[1]} | Life ${sc[2]} | Fate ${sc[3]}
Success ${sc[4]} | Health ${sc[5]} | Marriage ${sc[6]}
Interpretation: Balanced traits, progressive character detected.`;
};

// ----- Radar -----
function drawRadar(a){
 const c=document.getElementById('radar'),g=c.getContext('2d');
 const w=c.width,h=c.height,cx=w/2,cy=h/2,R=Math.min(w,h)/2-18;
 g.clearRect(0,0,w,h);g.strokeStyle='#17324a';g.lineWidth=1;
 for(let r=0.2;r<=1;r+=0.2){g.beginPath();
  for(let i=0;i<7;i++){const ang=i*2*Math.PI/7-Math.PI/2;
   const x=cx+Math.cos(ang)*R*r;const y=cy+Math.sin(ang)*R*r;
   i?g.lineTo(x,y):g.moveTo(x,y);}g.closePath();g.stroke();}
 g.beginPath();
 for(let i=0;i<7;i++){const ang=i*2*Math.PI/7-Math.PI/2;
  const x=cx+Math.cos(ang)*R*(a[i]/100);const y=cy+Math.sin(ang)*R*(a[i]/100);
  i?g.lineTo(x,y):g.moveTo(x,y);}
 g.closePath();g.fillStyle='rgba(22,240,167,.12)';g.fill();
 g.strokeStyle='#16f0a7';g.stroke();
}

// ----- PDF -----
document.getElementById('dlPdf').onclick=async()=>{
 if(!lastResult){alert('Analyze first');return;}
 await loadScript('https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js');
 const sc=lastResult.lines;
 const block=document.createElement('div');
 block.style.padding='20px';block.style.fontFamily='Inter,system-ui,Arial';block.style.color='#111';
 block.innerHTML=`
  <h1 style="margin:0 0 8px">Quantum Palm Analyzer ‚Äì Full Report</h1>
  <div style="font-size:12px;color:#444;margin-bottom:12px">
    Version 4.3.1 ‚Ä¢ ${new Date().toLocaleString()}
  </div>
  <img src="${canvas.toDataURL('image/jpeg',0.9)}" style="width:45%;border-radius:8px;border:1px solid #ddd"/>
  <h3>Line Scores</h3>
  <ul style="line-height:1.6">
    <li>Heart: ${sc[0]}</li>
    <li>Mind: ${sc[1]}</li>
    <li>Life: ${sc[2]}</li>
    <li>Fate: ${sc[3]}</li>
    <li>Success: ${sc[4]}</li>
    <li>Health: ${sc[5]}</li>
    <li>Marriage: ${sc[6]}</li>
  </ul>
  <p>Confidence: ${lastResult.confidence.toFixed(1)}%</p>
  <p>Overall Insight: Potential emotional clarity with stable energy lines.
  Suggested further study on balanced decision-making and vitality flow.</p>
  <hr/>
  <small>Note: This is a symbolic reading for research and educational use.</small>`;
 html2pdf().set({margin:10,filename:'QuantumPalmReport.pdf',
  image:{type:'jpeg',quality:0.98},
  html2canvas:{scale:2,useCORS:true},
  jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
 }).from(block).save();
};
function loadScript(src){
 return new Promise((resolve,reject)=>{
  if(document.querySelector(`script[src="${src}"]`))return resolve();
  const s=document.createElement('script');s.src=src;s.onload=resolve;s.onerror=reject;
  document.body.appendChild(s);
 });
}
</script>
</body>
</html>
