<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sathyadarshana ¬∑ Quantum Palm Analyzer ¬∑ True Vision v2.2.3</title>
<link rel="icon" href="./assets/icon.png">
<style>
:root{
  --bg:#0b0f16;--card:#101820;--neon:#00e5ff;--pri:#16f0a7;
}
body{
  margin:0;background:var(--bg);color:#e6f0ff;
  font-family:'Segoe UI',sans-serif;text-align:center;
}
h1{
  color:var(--neon);
  text-shadow:0 0 12px var(--neon);
  margin:16px 0;
}
#view{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin:20px}
.camBox{
  background:var(--card);
  border-radius:16px;
  padding:12px;
  width:90%;
  max-width:380px;
  box-shadow:0 0 10px #0007;
}
video,canvas{width:100%;border-radius:12px;}
button{
  background:var(--neon);color:#000;padding:8px 20px;margin:8px;
  border:none;border-radius:10px;font-weight:bold;cursor:pointer;
  box-shadow:0 0 10px var(--neon);
  transition:0.3s;
}
button:hover{box-shadow:0 0 20px var(--pri);}
#msg{margin-top:10px;color:#16f0a7}
.error{color:#ff6b6b}
input,select{
  width:90%;padding:8px;margin:6px 0;
  border-radius:8px;border:1px solid #16f0a7;
  background:#0b0f16;color:#e6f0ff;text-align:center;
}
small{color:#aaa;}
</style>
</head>
<body>
<h1>üñêÔ∏è Sathyadarshana Quantum Palm Analyzer ¬∑ True Vision v2.2.3</h1>

<div id="view">
  <div class="camBox">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" hidden></canvas>

    <div id="userForm">
      <input id="userName" placeholder="Full Name">
      <input id="userDOB" type="date">
      <input id="userNIC" placeholder="National ID / Passport No.">
      <select id="userGender">
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
    </div>

    <div>
      <button id="startBtn">üì∑ Start Camera</button>
      <button id="captureBtn">‚úã Capture Palm</button>
      <button id="analyzeBtn">üîÆ Analyze Palm</button>
    </div>
    <p id="msg">Awaiting camera...</p>
  </div>
</div>

<!-- Main Analyzer Script -->
<script type="module" src="./main.js"></script>

<!-- Local fallback clarity -->
<script>
if(!window.checkClarity){
  window.checkClarity = (img)=>{
    let diff=0,count=0;
    for(let i=0;i<img.data.length;i+=40){
      const l1=0.299*img.data[i]+0.587*img.data[i+1]+0.114*img.data[i+2];
      const l2=0.299*img.data[i+4]+0.587*img.data[i+5]+0.114*img.data[i+6];
      diff+=Math.abs(l1-l2);count++;
    }
    return Math.min(diff/count/50,1);
  }
}
</script>

<!-- üß† Buddhi Error Console -->
<div id="buddhiConsole" style="
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  max-height:120px;
  overflow-y:auto;
  background:#101820;
  color:#16f0a7;
  font-family:monospace;
  font-size:12px;
  border-top:1px solid #00e5ff;
  padding:4px;
  text-align:left;
  z-index:9999;
  display:none;
"></div>

<!-- üß© Console Controls -->
<div style="
  position:fixed;
  bottom:125px;
  right:10px;
  z-index:10000;
  display:flex;
  flex-direction:column;
  gap:6px;
">
  <button id="toggleConsole" style="
    background:#00e5ff;
    border:none;
    border-radius:6px;
    padding:6px 10px;
    font-size:12px;
    font-weight:bold;
    cursor:pointer;
    box-shadow:0 0 10px #00e5ff;
  ">üß† Show Log</button>

  <button id="clearConsole" style="
    background:#ff6b6b;
    border:none;
    border-radius:6px;
    padding:6px 10px;
    font-size:12px;
    font-weight:bold;
    cursor:pointer;
    box-shadow:0 0 10px #ff6b6b;
  ">üßπ Clear</button>
</div>

<script>
// Console hide/show/clear
const panel = document.getElementById("buddhiConsole");
const toggleBtn = document.getElementById("toggleConsole");
const clearBtn = document.getElementById("clearConsole");

toggleBtn.onclick = () => {
  const visible = panel.style.display !== "none";
  panel.style.display = visible ? "none" : "block";
  toggleBtn.textContent = visible ? "üß† Show Log" : "üôà Hide Log";
};
clearBtn.onclick = () => { panel.innerHTML = ""; };

// Error capture
window.onerror = function (message, source, lineno, colno) {
  const msg = document.createElement("div");
  msg.style.color = "#ff6b6b";
  msg.style.fontFamily = "monospace";
  msg.textContent = "‚ùå ERROR in " + (source.split("/").pop() || "unknown") +
    " [line " + lineno + ", col " + colno + "]: " + message;
  panel.appendChild(msg);
  panel.scrollTop = panel.scrollHeight;
  return true;
};
window.addEventListener("unhandledrejection", function (event) {
  const msg = document.createElement("div");
  msg.style.color = "#ffa500";
  msg.style.fontFamily = "monospace";
  msg.textContent = "‚ö†Ô∏è Promise rejection in " +
    (event.reason?.fileName ? event.reason.fileName.split("/").pop() : "unknown") +
    ": " + (event.reason?.message || event.reason);
  panel.appendChild(msg);
  panel.scrollTop = panel.scrollHeight;
});
</script>
</body>
</html>
