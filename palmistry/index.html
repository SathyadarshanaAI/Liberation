// =======================================================
// ğŸ•‰ï¸ Sathyadarshana Quantum Palm Analyzer Â· V27.0
// Module: edgeLines.js (Final Stable Version)
// =======================================================

// âš™ï¸ Detect and Draw Palm Edges Using OpenCV
export async function detectPalmEdges(frame, canvas) {
  return new Promise((resolve, reject) => {
    try {
      if (!window.cv || !cv.Mat) {
        console.warn("âš ï¸ OpenCV not ready yet!");
        reject("OpenCV not ready");
        return;
      }

      // ğŸ§  Convert frame to OpenCV Mat
      const mat = cv.matFromImageData(frame);
      let gray = new cv.Mat();
      let blur = new cv.Mat();
      let edges = new cv.Mat();

      // ğŸ¨ Step 1 â€” Convert to grayscale
      cv.cvtColor(mat, gray, cv.COLOR_RGBA2GRAY);

      // ğŸ¨ Step 2 â€” Reduce noise
      cv.GaussianBlur(gray, blur, new cv.Size(5, 5), 0);

      // ğŸ¨ Step 3 â€” Detect edges
      cv.Canny(blur, edges, 40, 150);

      // ğŸ©µ Draw glowing blue edges on canvas
      let colorEdges = new cv.Mat();
      cv.cvtColor(edges, colorEdges, cv.COLOR_GRAY2RGBA);

      const ctx = canvas.getContext("2d");
      cv.imshow(canvas, colorEdges);

      // ğŸ’¾ Clean up memory
      mat.delete();
      gray.delete();
      blur.delete();
      edges.delete();
      colorEdges.delete();

      // âœ… Return Mock AI Palm Data
      resolve({
        life: "clear and deep",
        heart: "curved with warmth",
        fate: "steady and firm",
      });
    } catch (err) {
      console.error("âŒ detectPalmEdges error:", err);
      reject(err);
    }
  });
}
