<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sathyadarshana · Quantum Palm Analyzer · Camera Debug v2.3.0</title>
<link rel="icon" href="./assets/icon.png">
<style>
body {
  margin:0; background:#0b0f16; color:#e6f0ff;
  font-family:'Segoe UI',sans-serif; text-align:center;
}
h1 { color:#00e5ff; text-shadow:0 0 10px #00e5ff; margin-top:20px; }
button {
  background:#00e5ff; color:#000; padding:8px 16px; margin:10px;
  border:none; border-radius:8px; font-weight:bold;
}
#log {
  background:#000; color:#0f0; font-family:monospace; font-size:13px;
  text-align:left; padding:8px; margin:10px; height:140px;
  overflow-y:auto; white-space:pre-line;
  border-radius:8px; border:1px solid #00e5ff;
}
video { width:90%; border-radius:10px; margin-top:10px; }
</style>
</head>
<body>
<h1>📷 Camera Debug Console</h1>
<button id="start">Start Camera</button>
<div><video id="video" autoplay playsinline></video></div>
<pre id="log">Initializing log...</pre>

<script>
const video = document.getElementById("video");
const logBox = document.getElementById("log");
const startBtn = document.getElementById("start");

function log(t){ logBox.textContent += "\n" + t; logBox.scrollTop = logBox.scrollHeight; }

// --- Universal error listener ---
window.addEventListener("error", e => log("❌ JS Error: " + e.message + " @ " + e.filename.split("/").pop() + ":" + e.lineno));
window.addEventListener("unhandledrejection", e => log("⚠️ Promise: " + (e.reason?.message || e.reason)));

// --- Start Camera ---
startBtn.onclick = async () => {
  try {
    log("Requesting camera...");
    const stream = await navigator.mediaDevices.getUserMedia({
      video:{ facingMode:"environment", width:{ideal:1280}, height:{ideal:720} },
      audio:false
    });
    video.srcObject = stream;
    const playPromise = video.play();
    if(playPromise) playPromise.catch(e => log("⚠️ Autoplay blocked: " + e.message));
    video.onloadeddata = ()=> log("✅ Camera active. Ready.");
  } catch(e){
    log("❌ Camera Error: " + e.name + " - " + e.message);
  }
};

// --- Permissions log ---
navigator.permissions?.query({name:"camera"}).then(r => log("🔍 Camera permission: " + r.state)).catch(()=>{});
navigator.mediaDevices?.enumerateDevices().then(d=>{
  const cams = d.filter(x=>x.kind==="videoinput");
  log("🎥 Detected cameras: " + cams.length + " (" + cams.map(c=>c.label||"Unnamed").join(", ") + ")");
});
</script>
</body>
</html>
