<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Palmistry Photo Analyzer ¬∑ v3.0 (Photo-only)</title>
<style>
:root{--pri:#16f0a7;--bg:#0b0f16;--neon:#00e5ff}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:#e6f0ff;font-family:system-ui;text-align:center}
h1{margin:14px 0 6px}
.stage{position:relative;width:92vw;max-width:420px;margin:0 auto 8px;border:2px solid var(--pri);border-radius:16px;overflow:hidden;background:#000;aspect-ratio:3/4}
.stage canvas{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;display:none}
button{border:none;border-radius:20px;padding:10px 16px;margin:4px;font-weight:700;cursor:pointer}
.btn{background:var(--neon);color:#000}
.sec{background:#222;color:#fff;border:1px solid var(--pri)}
.sec.active{background:var(--neon);color:#000;border-color:transparent}
.controls{display:flex;gap:10px;justify-content:center;align-items:center;margin:6px 0 2px}
.range{width:180px;accent-color:#3b82f6}
small{opacity:.8}
.legend{max-width:480px;margin:6px auto;display:grid;grid-template-columns:1fr 1fr;gap:6px;text-align:left}
.tag{display:flex;align-items:center;gap:8px;font-size:14px;opacity:.95}
.sw{width:14px;height:14px;border-radius:3px;border:1px solid #0003}
#err{max-width:480px;margin:6px auto;color:#ff9b9b;min-height:20px}
#summary{margin-top:8px}
#reportBox{max-width:480px;margin:12px auto;text-align:left;background:#101820;padding:12px;border-radius:12px;display:none}
#reportBox h3{text-align:center;color:#00e5ff;margin-top:0}
.downloadBtn{background:#00e5ff;color:#000;font-weight:bold;margin-top:10px}
footer{margin:12px 0 24px;opacity:.8}
</style>
</head>
<body>
<h1>Palmistry AI Analyzer ¬∑ Photo Mode (100% Compatible)</h1>

<div class="stage">
  <canvas id="base"></canvas>
  <canvas id="overlay"></canvas>
  <canvas id="labels"></canvas>
</div>

<div>
  <!-- Hand toggles -->
  <button id="handLeft"  class="sec">Left Hand</button>
  <button id="handRight" class="sec active">Right Hand</button>

  <!-- Photo inputs -->
  <button id="takePhoto" class="btn">üì∑ Take Photo</button>
  <button id="pickPhoto" class="sec">üñºÔ∏è Pick from Gallery</button>
  <input id="camInput"  type="file" accept="image/*" capture="environment" style="display:none">
  <input id="galInput"  type="file" accept="image/*" style="display:none">

  <!-- Flow -->
  <button id="analyze" class="sec">Analyze</button>
  <button id="reset" class="sec">Retake</button>
</div>

<div class="controls">
  <small>Threshold</small>
  <input id="thr" class="range" type="range" min="0" max="70" step="2" value="10" />
  <small id="thrVal">10</small>
</div>

<div class="legend">
  <div class="tag"><span class="sw" style="background:#ff5a7d"></span>Heart</div>
  <div class="tag"><span class="sw" style="background:#5aa3ff"></span>Head</div>
  <div class="tag"><span class="sw" style="background:#54f19a"></span>Life</div>
  <div class="tag"><span class="sw" style="background:#ffd24d"></span>Fate (Destiny)</div>
  <div class="tag"><span class="sw" style="background:#ffa64d"></span>Sun (Apollo)</div>
  <div class="tag"><span class="sw" style="background:#a78bfa"></span>Mercury (Health)</div>
  <div class="tag"><span class="sw" style="background:#ff9bd3"></span>Marriage</div>
</div>

<div id="err"></div>
<div id="summary">AI Summary: ‚Äî</div>

<div id="reportBox">
  <h3>ü™∂ Palmistry Insight Report</h3>
  <div id="reportText"></div>
  <button id="savePDF" class="downloadBtn">Download PDF</button>
</div>

<footer><small>¬© Sathyadarshana ¬∑ Research Build v3.0 (Photo-only) ¬∑ Works Offline</small></footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
/* ===== elements ===== */
const base = document.getElementById('base'),
      overlay = document.getElementById('overlay'),
      labels = document.getElementById('labels'),
      bctx = base.getContext('2d'),
      octx = overlay.getContext('2d'),
      lctx = labels.getContext('2d'),
      sum  = document.getElementById('summary'),
      errBox = document.getElementById('err'),
      report = document.getElementById('reportBox'),
      rtext  = document.getElementById('reportText'),
      thr    = document.getElementById('thr'),
      thrVal = document.getElementById('thrVal');

const handLeftBtn  = document.getElementById('handLeft');
const handRightBtn = document.getElementById('handRight');
const takePhotoBtn = document.getElementById('takePhoto');
const pickPhotoBtn = document.getElementById('pickPhoto');
const camInput = document.getElementById('camInput');
const galInput = document.getElementById('galInput');

let currentHand='right', locked=false;

/* ===== helpers ===== */
function showErr(m){ console.error(m); errBox.textContent=m||''; }
function showStack(){ [base,overlay,labels].forEach(c=>c.style.display='block'); }
function hideStack(){ [base,overlay,labels].forEach(c=>c.style.display='none'); }
function drawImageToBase(img){
  // fit image into canvas while keeping aspect
  const W = base.width = overlay.width = labels.width  = img.width;
  const H = base.height= overlay.height= labels.height = img.height;
  bctx.clearRect(0,0,W,H);
  bctx.drawImage(img,0,0,W,H);
}

/* ===== hand toggle ===== */
function setHand(h){
  currentHand = h;
  handLeftBtn.classList.toggle('active', h==='left');
  handRightBtn.classList.toggle('active',h==='right');
  sum.textContent = `Selected: ${h[0].toUpperCase()+h.slice(1)} hand`;
}
handLeftBtn.onclick  = ()=>setHand('left');
handRightBtn.onclick = ()=>setHand('right');

/* ===== photo inputs ===== */
takePhotoBtn.onclick = ()=> camInput.click();    // opens system Camera app
pickPhotoBtn.onclick = ()=> galInput.click();    // opens Gallery/Files picker

function handleFile(file){
  if(!file){ showErr('No image selected'); return; }
  const url = URL.createObjectURL(file);
  const img = new Image();
  img.onload = ()=>{
    drawImageToBase(img);
    locked = true;
    showStack();
    sum.textContent = 'Photo loaded. Ready to analyze.';
    URL.revokeObjectURL(url);
  };
  img.src = url;
}
camInput.onchange = e => handleFile(e.target.files?.[0]);
galInput.onchange = e => handleFile(e.target.files?.[0]);

/* ===== analyze (demo overlay) ===== */
document.getElementById('analyze').onclick = ()=>{
  if(!locked){ alert('Please take or pick a photo first'); return; }
  octx.clearRect(0,0,overlay.width,overlay.height);
  octx.fillStyle='rgba(255,255,255,0.1)';
  octx.fillRect(0,0,overlay.width,overlay.height);
  const H = currentHand[0].toUpperCase()+currentHand.slice(1);
  sum.textContent = `Analyze complete ¬∑ ${H} hand lines colored.`;
  showReport();
  saveResult();
};

/* live threshold label (placeholder) */
thr.addEventListener('input', ()=> thrVal.textContent = thr.value );

/* ===== reset ===== */
document.getElementById('reset').onclick = ()=>{
  locked=false; hideStack(); report.style.display='none';
  showErr(''); sum.textContent='AI Summary: ‚Äî';
};

/* ===== report / pdf ===== */
function showReport(){
  report.style.display='block';
  const lines=[
    {n:'Heart ‚ù§Ô∏è',t:'Emotional depth, compassion, love.'},
    {n:'Head üíô',t:'Intelligence, clarity, creativity.'},
    {n:'Life üíö',t:'Vitality, strength, endurance.'},
    {n:'Fate üíõ',t:'Career, destiny, life direction.'},
    {n:'Sun üß°',t:'Fame, talent, inspiration.'},
    {n:'Mercury üíú',t:'Health, intuition, communication.'},
    {n:'Marriage üíñ',t:'Harmony, bonds, emotional ties.'}
  ];
  rtext.innerHTML = lines.map(m=>`<p><b>${m.n}</b><br>${m.t}</p>`).join('');
}
document.getElementById('savePDF').onclick = ()=>{
  const {jsPDF}=window.jspdf; const doc=new jsPDF();
  doc.setFontSize(16); doc.text('Sathyadarshana Palmistry AI Insight Report',10,15);
  doc.setFontSize(12); doc.text('‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',10,20);
  const txt=rtext.innerText.split('\n'); let y=30;
  for(const t of txt){ if(t.trim()) doc.text(t,10,y), y+=8; }
  doc.save('Palmistry_AI_Report.pdf');
};

/* ===== results store ===== */
function saveResult(){
  const key='palmistryResults';
  const result={ ts:Date.now(), hand:currentHand, summary:'7 lines colored',
    lines:{heart:'Strong', head:'Balanced', life:'Long', fate:'Visible', sun:'Distinct', mercury:'Sharp', marriage:'Dual'}};
  const arr=JSON.parse(localStorage.getItem(key)||'[]'); arr.unshift(result);
  localStorage.setItem(key,JSON.stringify(arr));
  const toast=document.createElement('div');
  toast.textContent='Saved to Results. See ‚ÄúResults & Reports‚Äù.';
  toast.style.cssText='position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#00e5ff;color:#000;padding:8px 12px;border-radius:10px;font-weight:700;z-index:9999';
  document.body.appendChild(toast); setTimeout(()=>toast.remove(),2200);
}

/* init */
hideStack();
</script>
</body>
</html>‡∂†
