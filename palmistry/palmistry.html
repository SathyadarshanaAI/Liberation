<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Palmistry AI Overlay – Sathyadarshana</title>
<style>
:root{
  --pri:#16f0a7;--bg:#0b0f16;--neon:#00e5ff;
}
body{
  margin:0;
  background:var(--bg);
  color:#e6f0ff;
  font-family:system-ui;
  text-align:center;
}
h1{margin:14px 0 6px}
video,canvas{
  width:92vw;
  max-width:420px;
  border-radius:16px;
  border:2px solid var(--pri);
  display:block;
  margin:auto;
  background:#000;
}
.controls{
  display:flex;
  justify-content:center;
  gap:8px;
  margin-top:10px;
  flex-wrap:wrap;
}
button{
  background:#111;
  color:#fff;
  border:1px solid var(--neon);
  border-radius:8px;
  padding:8px 16px;
  font-size:15px;
  cursor:pointer;
}
button:hover{background:var(--neon);color:#000}
input[type=range]{
  width:140px;
}
footer{
  margin-top:14px;
  font-size:13px;
  opacity:.6;
}
</style>
</head>
<body>
<h1>✋ Palmistry</h1>
<p>Align palm → Capture → Analyze</p>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" width="420" height="320"></canvas>

<div class="controls">
  <button id="left">🖐 Left • Past</button>
  <button id="torch">🔦 Torch</button>
  <button id="capture">📸 Capture</button>
  <button id="analyze">✨ Analyze</button>
  <button id="save">💾 Save</button>
</div>

<div class="controls">
  <label>Edge</label><input type="range" id="edge" min="0" max="10" value="3">
  <label>Detail</label><input type="range" id="detail" min="1" max="10" value="5">
</div>

<footer>© 2025 Sathyadarshana · Palmistry AI Overlay</footer>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let stream;
let torchOn = false;

async function initCamera(){
  try{
    stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "environment" },
      audio: false
    });
    video.srcObject = stream;
  }catch(err){
    alert("Camera access denied: " + err.message);
  }
}

function capture(){
  if(!video.videoWidth){
    alert("Camera not ready! Please wait a second.");
    return;
  }
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  alert("Palm captured successfully!");
}

function analyze(){
  try{
    const img = ctx.getImageData(0,0,canvas.width,canvas.height);
    if(!img || !img.data){
      alert("No image data! Capture first.");
      return;
    }

    // Simple pixel intensity average (demo)
    let sum=0;
    for(let i=0;i<img.data.length;i+=4){
      let avg = (img.data[i]+img.data[i+1]+img.data[i+2])/3;
      sum+=avg;
    }
    let mean = sum/(img.data.length/4);
    mean = Math.round(mean);

    alert("Palm intensity score: " + mean);

  }catch(e){
    alert("Analyze error: " + e.message);
  }
}

function saveImage(){
  const a = document.createElement('a');
  a.download = 'palmistry-capture.png';
  a.href = canvas.toDataURL('image/png');
  a.click();
}

function toggleTorch(){
  try{
    const track = stream.getVideoTracks()[0];
    const capabilities = track.getCapabilities();
    if(!capabilities.torch){
      alert("Torch not supported on this device.");
      return;
    }
    torchOn = !torchOn;
    track.applyConstraints({advanced: [{torch: torchOn}]});
  }catch(e){
    alert("Torch error: " + e.message);
  }
}

document.getElementById('capture').onclick = capture;
document.getElementById('analyze').onclick = analyze;
document.getElementById('save').onclick = saveImage;
document.getElementById('torch').onclick = toggleTorch;

initCamera();
</script>
</body>
</html>
