<!DOCTYPE html><html lang="si">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Palmistry Universal v5.1 ¬∑ Extended Lines</title>
  <style>
    :root{--pri:#16f0a7;--bg:#0b0f16}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#e6f0ff;font-family:system-ui;text-align:center}
    h1{margin:14px 0 4px}
    small{opacity:.85}
    .stage{position:relative;display:inline-block;width:min(92vw,520px)}
    #cam{width:100%;border-radius:16px;border:2px solid var(--pri);background:#000;display:block}
    #cv{position:absolute;inset:0;width:100%;height:100%;border-radius:16px;display:none;pointer-events:none}
    .captureBtn{position:absolute;bottom:18px;left:50%;transform:translateX(-50%);width:86px;height:86px;border-radius:50%;border:none;background:#2196f3;color:#000;font-weight:700;box-shadow:0 0 15px #2196f333;cursor:pointer}
    .btns{margin:10px 0;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
    button,.btnLike{border:none;border-radius:10px;padding:.6em 1em;font-weight:700;cursor:pointer}
    .left{background:#16243a;color:#cfe9ff}
    .an{background:#16f0a7;color:#062}
    .cap{background:#fbbf24;color:#111}
    .torch{background:#22c55e;color:#021}
    .report{background:#a78bfa;color:#120}
    select.btnLike,input[type=file].btnLike{background:#19283f;color:#cfe9ff}
    .sliderRow{display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap;margin:10px 0 6px}
    .sliderRow label{display:flex;gap:8px;align-items:center}
    input[type=range]{accent-color:#16f0a7}
    #status{margin:8px auto 0;padding:10px;border:1px dashed #355;border-radius:10px;color:#cfe;max-width:900px;display:none;white-space:pre-wrap;text-align:left}
    #summary{max-width:900px;margin:10px auto;text-align:left;background:#0f1420;border:1px solid #243e60;border-radius:12px;padding:12px;display:none}
    #summary h3{margin:0 0 8px}
    .legend{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:6px 8px}
    .tag{display:inline-flex;gap:6px;align-items:center;margin:4px;padding:4px 10px;border-radius:999px;border:1px solid #2a4b72;background:#0d1a2c;color:#9fd6ff;font-size:.9em}
    .dot{width:12px;height:12px;border-radius:50%;display:inline-block}
    .dot.hrt{background:#ff3b3b}.dot.hd{background:#ffa533}.dot.life{background:#42ff6c}.dot.fate{background:#a1a1ff}.dot.sun{background:#ffd54a}.dot.marr{background:#ff8ab0}.dot.hlth{background:#5ad1ff}
    .toggles{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:6px 0}
    .toggles label{background:#142235;border:1px solid #29405f;padding:6px 10px;border-radius:10px;display:flex;align-items:center;gap:6px}
    footer{color:#16f0a7;margin:12px 0 22px;font-size:.9em}
    nav{display:flex;gap:10px;justify-content:center;margin:10px 0}
    nav a{color:#9fd6ff;text-decoration:none;border:1px solid #29405f;border-radius:10px;padding:6px 10px}
    nav a:hover{background:#0d1a2c}
  </style>
</head>
<body>
  <h1>üñêÔ∏è Palmistry Universal v5.1</h1>
  <small>Primary + Secondary Lines ¬∑ Capture ‚Üí Analyze ‚Üí Report</small>  <nav><a href="./index.html">‚Üê Back to Home</a></nav>  <div class="stage">
    <video id="cam" autoplay playsinline muted></video>
    <canvas id="cv"></canvas>
    <button class="captureBtn" id="capBtn">Capture</button>
  </div>  <div class="legend">
    <span class="tag"><span class="dot hrt"></span>Heart</span>
    <span class="tag"><span class="dot hd"></span>Head (Cheettha)</span>
    <span class="tag"><span class="dot life"></span>Life</span>
    <span class="tag"><span class="dot fate"></span>IraNami / Fate</span>
    <span class="tag"><span class="dot sun"></span>Sun</span>
    <span class="tag"><span class="dot marr"></span>Marriage</span>
    <span class="tag"><span class="dot hlth"></span>Health</span>
  </div>  <div class="toggles">
    <label><input type="checkbox" id="tPrimary" checked> Primary (Heart/Head/Life)</label>
    <label><input type="checkbox" id="tFate" checked> IraNami/Fate</label>
    <label><input type="checkbox" id="tSun" checked> Sun</label>
    <label><input type="checkbox" id="tMarr" checked> Marriage</label>
    <label><input type="checkbox" id="tHealth" checked> Health</label>
  </div>  <div class="btns">
    <button class="btnLike" id="startBtn">‚ñ∂Ô∏è Start</button>
    <select id="camsel" class="btnLike"></select>
    <button class="btnLike" id="cycleBtn">üîÅ Cycle</button><select id="resSel" class="btnLike">
  <option value="1280x720">HD 1280√ó720</option>
  <option value="1920x1080">FullHD 1920√ó1080</option>
  <option value="640x480">VGA 640√ó480</option>
</select>
<select id="fpsSel" class="btnLike">
  <option value="30">30 FPS</option>
  <option value="60">60 FPS</option>
  <option value="24">24 FPS</option>
</select>

<input id="pick" type="file" accept="image/*" class="btnLike" />
<button class="left" id="flipBtn">‚ÜîÔ∏è Flip</button>
<button class="torch" id="torchBtn" hidden>üî¶ Torch</button>
<label class="btnLike" style="display:flex;align-items:center;gap:8px">
  Zoom <input id="zoom" type="range" min="1" max="1" step="0.1" value="1" style="width:120px">
</label>

<button class="an" id="anBtn">‚ú® Analyze</button>
<button class="report" id="reportBtn">üìÑ Report</button>
<button class="btnLike" id="clearBtn">üßπ Clear</button>

  </div>  <div class="sliderRow">
    <label>Edge <input id="edge" type="range" min="40" max="110" value="75"></label>
    <label>Detail <input id="gk" type="range" min="1" max="5" value="3"></label>
  </div>  <div id="status"></div>
  <div id="summary">
    <h3>üîé AI Summary</h3>
    <div id="sumtext"></div>
  </div>  <footer>¬© 2025 Sathyadarshana ¬∑ Palmistry AI Overlay v5.1</footer><script>
/* ===== refs ===== */
const video=byId('cam'), cv=byId('cv'), ctx=cv.getContext('2d');
const startBtn=byId('startBtn'), camsel=byId('camsel'), cycleBtn=byId('cycleBtn');
const resSel=byId('resSel'), fpsSel=byId('fpsSel'), zoomEl=byId('zoom');
const pick=byId('pick'), flipBtn=byId('flipBtn'), torchBtn=byId('torchBtn');
const capBtn=byId('capBtn'), anBtn=byId('anBtn'), reportBtn=byId('reportBtn'), clearBtn=byId('clearBtn');
const tPrimary=byId('tPrimary'), tFate=byId('tFate'), tSun=byId('tSun'), tMarr=byId('tMarr'), tHealth=byId('tHealth');
let stream=null, track=null, captured=false, isMirrored=false, last=null;
let camList=[], camIndex=0;

function byId(x){return document.getElementById(x)}
function msg(t){ const s=byId('status'); s.textContent=t; s.style.display='block'; }
function showSummary(html){ const b=byId('summary'); byId('sumtext').innerHTML=html; b.style.display='block'; }
function parseRes(v){const [w,h]=v.split('x').map(Number);return {w,h};}

/* ===== normalize big photos for speed ===== */
function norm(maxW=1280,maxPx=1_500_000){
  if(cv.width<=0||cv.height<=0) return; const tooW=cv.width>maxW, tooPx=cv.width*cv.height>maxPx;
  if(!(tooW||tooPx)) return; const s=Math.min(maxW/cv.width, Math.sqrt(maxPx/(cv.width*cv.height)));
  const w=Math.max(Math.round(cv.width*s),540), h=Math.round(cv.height*s);
  const t=document.createElement('canvas'); t.width=w; t.height=h; t.getContext('2d').drawImage(cv,0,0,w,h);
  cv.width=w; cv.height=h; ctx.drawImage(t,0,0);
}

/* ===== camera core ===== */
async function ensurePerm(){ if(!navigator.mediaDevices?.getUserMedia) throw new Error('No mediaDevices'); const t=await navigator.mediaDevices.getUserMedia({video:true,audio:false}); t.getTracks().forEach(x=>x.stop()); }
async function listCams(){ const devs=await navigator.mediaDevices.enumerateDevices(); camList=devs.filter(d=>d.kind==='videoinput').sort((a,b)=>(/back|rear|environment|wide/i.test(a.label)?-1:1)); camsel.innerHTML=''; camList.forEach((c,i)=>{const o=document.createElement('option'); o.value=c.deviceId; o.textContent=c.label||`Camera ${i+1}`; camsel.appendChild(o);}); camsel.selectedIndex=0; camIndex=0; }
async function startCam(id=null){ if(stream){stream.getTracks().forEach(t=>t.stop()); stream=null; track=null;}
  const {w,h}=parseRes(resSel.value||'1280x720'); const fps=Number(fpsSel.value||30); const facing=isMirrored?'user':'environment';
  const cons={video: id?{deviceId:{exact:id}}:{facingMode:{ideal:facing}}, audio:false}; Object.assign(cons.video,{width:{ideal:w,max:w},height:{ideal:h,max:h},frameRate:{ideal:fps,max:fps},advanced:[{focusMode:'continuous'},{exposureMode:'continuous'}]});
  try{ stream=await navigator.mediaDevices.getUserMedia(cons);}catch(e){ try{ stream=await navigator.mediaDevices.getUserMedia({video:true,audio:false}); }catch(err){ msg('‚ùå Camera error: '+err.message); return; }}
  video.srcObject=stream; await video.play(); track=stream.getVideoTracks()[0];
  const W=video.videoWidth||w, H=video.videoHeight||h; cv.width=W; cv.height=H; video.style.transform=isMirrored?'scaleX(-1)':'none'; cv.style.display=captured?'block':'none';
  const caps=track.getCapabilities?.()||{}; torchBtn.hidden=!('torch' in caps); if('zoom' in caps){ zoomEl.min=caps.zoom.min||1; zoomEl.max=caps.zoom.max||5; zoomEl.step=caps.zoom.step||0.1; zoomEl.value=(track.getSettings?.().zoom)||zoomEl.min; zoomEl.parentElement.style.display=''; } else { zoomEl.parentElement.style.display='none'; }
  msg(`üì∑ ${track.label||'Camera'} ‚Ä¢ ${W}√ó${H}@${fps}`);
}

startBtn.onclick= async ()=>{ try{ if(location.protocol!=='https:' && location.hostname!=='localhost') msg('üîí Use HTTPS for best camera support'); await ensurePerm(); await listCams(); await startCam(camsel.value||camList[0]?.deviceId||null);}catch(e){msg('‚ùå '+(e.message||e));}};
cycleBtn.onclick= async ()=>{ if(!camList.length) await listCams(); if(!camList.length) return msg('No cameras'); camIndex=(camIndex+1)%camList.length; camsel.selectedIndex=camIndex; await startCam(camList[camIndex].deviceId); };
camsel.onchange= async ()=> startCam(camsel.value);
resSel.onchange = async ()=> startCam(camsel.value||null);
fpsSel.onchange = async ()=> startCam(camsel.value||null);
flipBtn.onclick = async ()=>{ isMirrored=!isMirrored; if(stream&&!captured){ video.style.transform=isMirrored?'scaleX(-1)':'none'; await startCam(camsel.value||null);} else if(captured){ mirrorCanvas(); } };
torchBtn.onclick= async ()=>{ if(!track) return; try{ const on=(track.getSettings?.().torch)||false; await track.applyConstraints({advanced:[{torch:!on}]}); }catch(e){ msg('Torch error: '+e.message); } };
zoomEl.oninput  = async ()=>{ if(!track) return; try{ await track.applyConstraints({advanced:[{zoom:Number(zoomEl.value)}]}); }catch{} };

function mirrorCanvas(){ const t=document.createElement('canvas'); t.width=cv.width; t.height=cv.height; t.getContext('2d').drawImage(cv,0,0); ctx.save(); ctx.setTransform(-1,0,0,1,cv.width,0); ctx.drawImage(t,0,0); ctx.restore(); }

/* capture / file */
capBtn.onclick = async ()=>{ if(!stream) await startCam(camsel.value||null); if(!video.videoWidth) await new Promise(r=>setTimeout(r,100)); cv.width=video.videoWidth; cv.height=video.videoHeight; ctx.save(); if(isMirrored){ ctx.translate(cv.width,0); ctx.scale(-1,1);} ctx.drawImage(video,0,0,cv.width,cv.height); ctx.restore(); norm(1280,1_500_000); cv.style.display='block'; captured=true; last=null; byId('summary').style.display='none'; msg('üñêÔ∏è Photo locked. Analyze to detect lines.'); };
pick.onchange = e=>{ const f=e.target.files?.[0]; if(!f) return; const img=new Image(); img.onload=()=>{ cv.width=img.naturalWidth; cv.height=img.naturalHeight; ctx.drawImage(img,0,0); if(isMirrored) mirrorCanvas(); norm(1280,1_500_000); cv.style.display='block'; captured=true; last=null; byId('summary').style.display='none'; msg('üñºÔ∏è Photo loaded. Analyze to detect lines.'); }; img.onerror=()=>msg('‚ùå Image load failed'); img.src=URL.createObjectURL(f); };
clearBtn.onclick= ()=>{ ctx.clearRect(0,0,cv.width,cv.height); captured=false; cv.style.display='none'; last=null; byId('summary').style.display='none'; msg('üßπ Cleared. Ready.'); };

/* report */
reportBtn.onclick= ()=>{ if(!captured){ msg('Capture first'); return; } const data=cv.toDataURL('image/png'); const s=last?buildSummary(last):'<p>Run Analyze first.</p>'; const w=window.open('','_blank'); w.document.write(`<html><head><title>Palmistry Report</title><style>body{font-family:system-ui;padding:12px;color:#123}h2{margin:6px 0}.box{border:1px solid #ccd;padding:10px;border-radius:10px}img{max-width:100%}</style></head><body><h2>üñêÔ∏è Palmistry Report</h2><div class="box"><img src="${data}"/></div><div class="box">${s}</div></body></html>`); w.document.close(); };/* ===== ANALYZE v5.1 (syntax/logic fixed) ===== */ anBtn.onclick= ()=>{ if(!captured) return msg('‚ùó‡∂¥‡∑Ö‡∂∏‡∑î‡∑Ä Capture ‡∑Ñ‡∑ù Choose Photo ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.'); msg('‚è≥ Analyzing‚Ä¶'); setTimeout(()=>{ try{ analyzeV5(); }catch(e){ console.error(e); msg('‚ùå Analyze failed: '+(e.message||e)); } }, 50); };

function analyzeV5(){ if(!cv.width || !cv.height){ msg('No canvas'); return; } norm(1024, 1_000_000);

let w=cv.width, h=cv.height, src; // Safe getImageData with downscale on failure for(let i=0;i<2;i++){ try{ src = ctx.getImageData(0,0,w,h); break; } catch(e){ const t=document.createElement('canvas'); t.width=Math.round(w0.8); t.height=Math.round(h0.8); t.getContext('2d').drawImage(cv,0,0,t.width,t.height); cv.width=t.width; cv.height=t.height; ctx.drawImage(t,0,0); w=cv.width; h=cv.height; } }

const wh=w*h; const edgeVal=parseInt(byId('edge').value,10)/255; const passes =parseInt(byId('gk').value,10);

// grayscale const d=src.data; const gray=new Uint8ClampedArray(wh); for(let i=0,j=0;i<d.length;i+=4,j++) gray[j]= d[i]*0.299 + d[i+1]*0.587 + d[i+2]*0.114;

// blur 3x3 let a=Float32Array.from(gray); const k=[1,2,1,2,4,2,1,2,1], kn=16; for(let p=0;p<passes;p++){ const t=new Float32Array(wh); for(let y=1;y<h-1;y++) for(let x=1;x<w-1;x++){ let s=0,i=0; for(let dy=-1;dy<=1;dy++) for(let dx=-1;dx<=1;dx++) s += a[(y+dy)w+(x+dx)] * k[i++]; t[yw+x]=s/kn; } a=t; } const blur=Uint8ClampedArray.from(a);

// sobel const mag=new Float32Array(wh); let mx=1; for(let y=1;y<h-1;y++) for(let x=1;x<w-1;x++){ const i=yw+x; const gx=-blur[i-w-1]-2blur[i-1]-blur[i+w-1] + blur[i-w+1]+2blur[i+1]+blur[i+w+1]; const gy=-blur[i-w-1]-2blur[i-w]-blur[i-w+1] + blur[i+w-1]+2blur[i+w]+blur[i+w+1]; const m=Math.hypot(gx,gy); mag[i]=m; if(m>mx) mx=m; } const T=edgeValmx; const bin=new Uint8ClampedArray(wh); for(let i=0;i<wh;i++) bin[i]= mag[i]>T ? 1:0;

// skeletonize (Zhang‚ÄìSuen) const sk=Uint8Array.from(bin); let changed=true,pass=0; const N=(x,y)=> sk[(y-1)*w+x]+sk[(y-1)w+x+1]+sk[yw+x+1]+sk[(y+1)*w+x+1]+sk[(y+1)*w+x]+sk[(y+1)w+x-1]+sk[yw+x-1]+sk[(y-1)*w+x-1]; const S=(x,y)=>{ const p=[sk[(y-1)*w+x],sk[(y-1)w+x+1],sk[yw+x+1],sk[(y+1)*w+x+1],sk[(y+1)*w+x],sk[(y+1)w+x-1],sk[yw+x-1],sk[(y-1)w+x-1]]; let t=0; for(let i=0;i<8;i++) if(p[i]==0&&p[(i+1)%8]==1) t++; return t; }; while(changed&&pass<20){ changed=false; let rem=[]; for(let y=1;y<h-1;y++)for(let x=1;x<w-1;x++){ const i=yw+x; if(!sk[i]) continue; const nn=N(x,y), s=S(x,y); if(nn>=2&&nn<=6&&s==1 && (sk[(y-1)*w+x]sk[yw+x+1]*sk[(y+1)w+x]==0) && (sk[yw+x+1]sk[yw+x-1]*sk[(y-1)w+x]==0)) rem.push(i); } rem.forEach(i=>sk[i]=0); if(rem.length) changed=true; rem=[]; for(let y=1;y<h-1;y++)for(let x=1;x<w-1;x++){ const i=yw+x; if(!sk[i]) continue; const nn=N(x,y), s=S(x,y); if(nn>=2&&nn<=6&&s==1 && (sk[(y-1)*w+x]sk[yw+x-1]*sk[(y+1)*w+x]==0) && (sk[(y-1)*w+x]sk[yw+x+1]sk[yw+x-1]==0)) rem.push(i); } rem.forEach(i=>sk[i]=0); if(rem.length) changed=true; pass++; }

// region helpers function band(y0,y1){ const m=new Uint8Array(wh); for(let y=y0;y<y1;y++) for(let x=0;x<w;x++) m[yw+x]=1; return m; } function rect(x0,y0,x1,y1){ const m=new Uint8Array(wh); for(let y=y0;y<y1;y++) for(let x=x0;x<x1;x++) m[yw+x]=1; return m; }

// component walker function pickLongest(mask){ const seen=new Uint8Array(wh); const NB=[-1-w,-w,1-w,-1,1,-1+w,w,1+w]; let best=[]; function walk(i0){ const st=[i0], pts=[]; seen[i0]=1; while(st.length){ const i=st.pop(); const y=(i/w)|0, x=i%w; pts.push([x,y]); for(const d8 of NB){ const j=i+d8; if(j>0&&j<wh && mask[j] && sk[j] && !seen[j]){ seen[j]=1; st.push(j);} } } return pts; } for(let y=1;y<h-1;y++) for(let x=1;x<w-1;x++){ const i=y*w+x; if(mask[i]&&sk[i]&&!seen[i]){ const p=walk(i); if(p.length>best.length) best=p; } } return best; }

function pickTopK(mask, K=3, minLen=30, maxLen=140, preferHorizontal=true){ const seen=new Uint8Array(wh); const NB=[-1-w,-w,1-w,-1,1,-1+w,w,1+w]; const segs=[]; function walk(i0){ const st=[i0], pts=[]; seen[i0]=1; while(st.length){ const i=st.pop(); const y=(i/w)|0, x=i%w; pts.push([x,y]); for(const d8 of NB){ const j=i+d8; if(j>0&&j<wh && mask[j] && sk[j] && !seen[j]){ seen[j]=1; st.push(j);} } } return pts; } function polyLen(p){ let L=0; for(let i=1;i<p.length;i++){ const dx=p[i][0]-p[i-1][0], dy=p[i][1]-p[i-1][1]; L+=Math.hypot(dx,dy);} return L; } function orient(p){ if(p.length<2) return 0; const A=p[0], B=p[p.length-1]; return Math.atan2(B[1]-A[1], B[0]-A[0]); } for(let y=1;y<h-1;y++) for(let x=1;x<w-1;x++){ const i=y*w+x; if(mask[i]&&sk[i]&&!seen[i]){ const p=walk(i); const L=polyLen(p); if(L>=minLen && L<=maxLen){ let ok=true; if(preferHorizontal){ const ang=Math.abs(orient(p)*180/Math.PI); ok = (ang<25 || ang>155); } if(ok) segs.push(p); } } } segs.sort((a,b)=>polyLen(b)-polyLen(a)); return segs.slice(0,K); }

// bands const yHeart0=0, yHeart1=Math.floor(h0.30); const yHead0=yHeart1, yHead1=Math.floor(h0.55); const yLife0=yHead1,  yLife1=h;

// primary const pHeart=pickLongest(band(yHeart0,yHeart1)); const pHead =pickLongest(band(yHead0,yHead1)); const pLife =pickLongest(band(yLife0,yLife1));

// secondary heuristics const xC0=Math.floor(w0.40), xC1=Math.floor(w0.60), yF0=Math.floor(h*0.35), yF1=h; const pFate=pickLongest(rect(xC0,yF0,xC1,yF1));

const xS0=Math.floor(w0.60), xS1=Math.floor(w0.80), yS0=Math.floor(h*0.40), yS1=h; const pSun =pickLongest(rect(xS0,yS0,xS1,yS1));

const xM0=Math.floor(w0.70), xM1=w, yM0=Math.floor(h0.10), yM1=Math.floor(h*0.25); const pMarriage=pickTopK(rect(xM0,yM0,xM1,yM1), 3, 40, 120, true);

const xH0=Math.floor(w0.55), xH1=w, yH0=Math.floor(h0.55), yH1=h; const pHealth=pickLongest(rect(xH0,yH0,xH1,yH1));

// faint edges const overlay=ctx.createImageData(w,h); for(let i=0,j=0;i<wh;i++,j+=4){ if(bin[i]){ overlay.data[j]=0; overlay.data[j+1]=255; overlay.data[j+2]=255; overlay.data[j+3]=70; } } ctx.putImageData(overlay,0,0);

// draw paths function drawPath(pts,color,wid){ if(!pts||pts.length<5) return; ctx.lineJoin='round'; ctx.lineCap='round'; ctx.strokeStyle='#000'; ctx.lineWidth=wid+2; ctx.beginPath(); ctx.moveTo(pts[0][0],pts[0][1]); for(const [x,y] of pts) ctx.lineTo(x,y); ctx.stroke(); ctx.strokeStyle=color; ctx.lineWidth=wid; ctx.beginPath(); ctx.moveTo(pts[0][0],pts[0][1]); for(const [x,y] of pts) ctx.lineTo(x,y); ctx.stroke(); } const M=(p)=>{ function polyLen(p){ let L=0; for(let i=1;i<p.length;i++){ const dx=p[i][0]-p[i-1][0], dy=p[i][1]-p[i-1][1]; L+=Math.hypot(dx,dy);} return L; } function orient(p){ if(p.length<2) return 0; const A=p[0], B=p[p.length-1]; return Math.atan2(B[1]-A[1], B[0]-A[0]); } function gaps(p){ let g=0; for(let i=2;i<p.length;i++) if(Math.hypot(p[i][0]-p[i-1][0], p[i][1]-p[i-1][1])>6) g++; return g; } return {len:polyLen(p)|0, slope:orient(p), gaps:gaps(p)}; };

ctx.globalAlpha=0.95; if(tPrimary.checked){ drawPath(pHeart,'#ff3b3b',4); drawPath(pHead,'#ffa533',4); drawPath(pLife,'#42ff6c',4); } if(tFate.checked)   drawPath(pFate,'#a1a1ff',3.5); if(tSun.checked)    drawPath(pSun,'#ffd54a',3.5); if(tMarr.checked)   pMarriage.forEach(p=>drawPath(p,'#ff8ab0',3)); if(tHealth.checked) drawPath(pHealth,'#5ad1ff',3.5); ctx.globalAlpha=1; cv.style.display='block';

last={ heart:M(pHeart), head:M(pHead), life:M(pLife), fate:M(pFate), sun:M(pSun), marriage:pMarriage.map(M), health:M(pHealth) }; showSummary(buildSummary(last)); msg('‚ú® Analyze done'); }

function buildSummary(m){ const grade=(L,G)=> (L<80?'weak': G>15?'fragmented': L>220?'strong':'moderate'); const ori=(r)=>{ const d=r*180/Math.PI; return d<-25?'tilt-up': d>25?'tilt-down':'level'; }; const line=(name,mm)=> (!mm||!mm.len) ? ${name}: n/a : ${name}: <b>${grade(mm.len,mm.gaps)}</b> (${ori(mm.slope)}), ~${mm.len}, gaps ${mm.gaps}.; const pri = ‚ù§Ô∏è ${line('Heart',m.heart)}<br>üß° ${line('Head',m.head)}<br>üíö ${line('Life',m.life)}; const sec = üü™ IraNami/Fate: ${line('Fate',m.fate)}<br>üü® Sun: ${line('Sun',m.sun)}<br>ü©∑ Marriage: ${ m.marriage&&m.marriage.length? m.marriage.map((x,i)=>#${i+1} ~${x.len}).join(', ') : 'n/a' }<br>ü©µ Health: ${line('Health',m.health)}; return <p>${pri}</p><hr/><p>${sec}</p>; }

window.addEventListener('load', ()=>{ msg('‚ñ∂Ô∏è Start ‚Üí Allow camera. Capture/Upload ‚Üí Analyze. Use toggles to show/hide lines.'); }); </script>

</body>
</html>
