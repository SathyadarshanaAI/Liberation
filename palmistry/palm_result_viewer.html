<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Palmistry ‚Äî Result Viewer</title>
  <style>
    :root{
      --bg:#0f1115;
      --card:#12161d;
      --text:#e9eef6;
      --muted:#a7b1c2;
      --accent:#31d0ff;
      --border:#1f2630;
      --ok:#00d084;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font: 16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    }
    header{
      position:sticky; top:0; z-index:5;
      background:linear-gradient(180deg,#0f1115 0%, #0f1115cc 70%, #0f111500 100%);
      padding:14px 16px 10px; border-bottom:1px solid var(--border);
      display:flex; flex-wrap:wrap; gap:12px; align-items:center;
    }
    header h1{margin:0; font-size:20px; letter-spacing:.2px}
    header .dot{color:#ffd166}
    .toolbar{display:flex; gap:10px; align-items:center; margin-left:auto; flex-wrap:wrap}
    label{color:var(--muted); font-size:14px; margin-right:6px}
    select,button{
      background:#0e131a; color:var(--text);
      border:1px solid var(--border); border-radius:10px;
      padding:8px 12px; outline:none;
    }
    button{cursor:pointer}
    main{display:grid; gap:16px; grid-template-columns:1fr 360px; padding:16px}
    @media (max-width:900px){ main{grid-template-columns:1fr} }

    .panel{
      background:var(--card); border:1px solid var(--border); border-radius:14px;
      box-shadow:0 0 0 1px #000 inset, 0 8px 24px rgba(0,0,0,.35);
    }
    .img-wrap{display:flex; justify-content:center; align-items:center; padding:14px}
    .img-wrap img{
      max-width:100%; height:auto; border-radius:12px;
      box-shadow:0 0 0 2px #0af3ff66, 0 0 28px #00e5ff22;
      background:#fff;
    }

    .side{padding:14px}
    .side h3{margin:4px 0 12px; font-size:18px}
    .meta{display:flex; gap:10px; align-items:center; color:var(--muted); font-size:14px; margin-bottom:12px}
    .pill{padding:2px 8px; border-radius:999px; border:1px solid var(--border); background:#0b1016}
    .ok{color:var(--ok)}
    .accent{color:var(--accent)}

    #reportBox{
      white-space:pre-wrap; background:#0b1016; border:1px dashed var(--border);
      padding:10px; border-radius:10px; min-height:260px; direction:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size:14px; color:#eaf2ff;
    }
    .footer{padding:18px; text-align:center; color:var(--muted); font-size:12px}
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <header>
    <h1>üñêÔ∏è Palmistry <span class="dot">‚Äî</span> <span class="accent">Result Viewer</span></h1>

    <div class="toolbar">
      <div>
        <label for="langSel">Report:</label>
        <select id="langSel" aria-label="Report language"></select>
      </div>

      <div>
        <label for="refreshSel">Auto-refresh:</label>
        <select id="refreshSel" aria-label="Auto refresh interval">
          <option value="0">Off</option>
          <option value="5">5s</option>
          <option value="10" selected>10s</option>
          <option value="30">30s</option>
          <option value="60">60s</option>
        </select>
        <button id="btnRefresh">Refresh now</button>
      </div>
    </div>
  </header>

  <main>
    <!-- Image preview -->
    <section class="panel img-wrap">
      <!-- Use out.png (symlink/copy of result.png) -->
      <img id="resultImg" src="out.png" alt="Detected Palm Lines" />
    </section>

    <!-- Report panel -->
    <aside class="panel side">
      <h3>Report</h3>
      <div class="meta">
        <span class="pill">image: <code>out.png</code></span>
        <span class="pill">status: <span id="imgStatus" class="ok">OK</span></span>
      </div>
      <pre id="reportBox">Loading‚Ä¶</pre>
    </aside>
  </main>

  <div class="footer">
    Open image: <a href="out.png" target="_blank" rel="noopener">out.png</a> ¬∑
    JSON: <a href="out.json" target="_blank" rel="noopener">out.json</a> ¬∑
    English report: <a href="report_en.txt" target="_blank" rel="noopener">report_en.txt</a>
  </div>

  <script>
    // --- language list + RTL handling ---
    const LANGS = [
      ["en","English"],
      ["si","‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω"],
      ["ta","‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)"],
      ["hi","‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)"],
      ["ar","ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (Arabic)"],
      ["es","Espa√±ol (Spanish)"],
      ["fr","Fran√ßais (French)"],
      ["de","Deutsch (German)"],
      ["zh-CN","‰∏≠Êñá (Chinese)"],
      ["ja","Êó•Êú¨Ë™û (Japanese)"]
    ];
    const RTL = new Set(["ar"]);

    const $ = (id)=>document.getElementById(id);
    const langSel = $("langSel");
    const refreshSel = $("refreshSel");
    const btnRefresh = $("btnRefresh");
    const reportBox = $("reportBox");
    const resultImg = $("resultImg");
    const imgStatus = $("imgStatus");

    // Populate dropdown
    LANGS.forEach(([value,label])=>{
      const opt=document.createElement("option");
      opt.value=value; opt.textContent=label;
      langSel.appendChild(opt);
    });

    // Pick default by browser language
    const supported = new Set(LANGS.map(x=>x[0]));
    const browserLang = (navigator.language||"en");
    const defLang = supported.has(browserLang) ? browserLang : "en";
    langSel.value = defLang;

    // Load report file
    async function loadReport(lang){
      const file = lang==="en" ? "report_en.txt" : `report_${lang}.txt`;
      try{
        const res = await fetch(`${file}?v=${Date.now()}`); // cache-bust
        if(!res.ok) throw new Error(res.status);
        const txt = await res.text();
        reportBox.textContent = txt.trim() || "(empty)";
      }catch(e){
        reportBox.textContent = `Report not found for "${lang}". Looking for: ${file}`;
      }
      // RTL support
      reportBox.dir = RTL.has(lang) ? "rtl" : "auto";
    }

    // Refresh image with cache-busting
    function refreshImage(){
      const url = new URL(resultImg.src, location.href);
      url.searchParams.set("v", Date.now());
      resultImg.src = url.toString();
    }

    // Polling control
    let timer = null;
    function applyInterval(){
      if (timer) clearInterval(timer);
      const sec = parseInt(refreshSel.value,10);
      if (sec>0) timer = setInterval(()=>{ refreshImage(); loadReport(langSel.value); }, sec*1000);
    }

    // Events
    langSel.addEventListener("change", ()=>loadReport(langSel.value));
    refreshSel.addEventListener("change", applyInterval);
    btnRefresh.addEventListener("click", ()=>{ refreshImage(); loadReport(langSel.value); });

    resultImg.addEventListener("load", ()=>{ imgStatus.textContent="OK"; imgStatus.classList.add("ok"); });
    resultImg.addEventListener("error", ()=>{ imgStatus.textContent="missing"; imgStatus.classList.remove("ok"); });

    // Initial load
    loadReport(defLang);
    applyInterval();
  </script>
</body>
</html>
